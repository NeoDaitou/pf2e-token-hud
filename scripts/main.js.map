{
  "version": 3,
  "sources": ["../src/actions/use-resolve.js", "../src/pf2e/classes.js", "../src/pf2e/dc.js", "../src/pf2e/dom.js", "../src/pf2e/misc.js", "../src/pf2e/scripts.js", "../src/pf2e/inline-roll.js", "../src/shared.js", "../src/popup.js", "../src/pf2e/item.js", "../src/pf2e/weapon.js", "../src/pf2e/success.js", "../src/actions/recall-knowledge.js", "../src/sidebars/skills.js", "../src/sidebars/extras.js", "../src/sidebars/actions.js", "../src/sidebars/hazard.js", "../src/pf2e/identify.js", "../src/tooltip.js", "../src/sidebars/items.js", "../src/sidebars/spells.js", "../src/hud.js", "../src/module.js", "../src/keybindings.js", "../src/settings.js", "../src/main.js"],
  "sourcesContent": ["import { localize, templatePath } from '../module.js'\r\n\r\nconst RESOLVE_UUID = 'Compendium.pf2e.feats-srd.Item.jFmdevE4nKevovzo'\r\n\r\nexport async function useResolve(actor) {\r\n    function toChat(content) {\r\n        ChatMessage.create({\r\n            user: game.user.id,\r\n            content,\r\n            speaker: ChatMessage.getSpeaker({ actor }),\r\n        })\r\n    }\r\n\r\n    const { name, attributes, system } = actor\r\n    const sp = attributes.hp.sp\r\n    const resolve = system.resources.resolve\r\n    const fullStamina = localize('hud.resolve.full', { name })\r\n    const noResolve = game.i18n.format('PF2E.Actions.SteelYourResolve.NoStamina', { name })\r\n\r\n    if (sp.value === sp.max) return ui.notifications.warn(fullStamina)\r\n    if (resolve.value < 1) return ui.notifications.warn(noResolve)\r\n\r\n    const hasSteel = actor.itemTypes.feat.find(item => item.sourceId === RESOLVE_UUID)\r\n    const content = await renderTemplate(templatePath('dialogs/resolve'), {\r\n        hasSteel,\r\n        i18n: str => localize(`hud.resolve.${str}`),\r\n    })\r\n\r\n    new Dialog({\r\n        title: localize('hud.resolve.title'),\r\n        content,\r\n        buttons: {\r\n            yes: {\r\n                icon: \"<i class='fas fa-check'></i>\",\r\n                label: localize('hud.resolve.yes'),\r\n                callback: async html => {\r\n                    const { attributes, system } = actor\r\n                    const sp = attributes.hp.sp\r\n                    const resolve = system.resources.resolve\r\n\r\n                    if (sp.value === sp.max) return toChat(fullStamina)\r\n                    if (resolve.value < 1) return toChat(noResolve)\r\n\r\n                    const selected = html.find('input:checked').val()\r\n                    const ratio = `${sp.value}/${sp.max}`\r\n\r\n                    if (selected === 'breather') {\r\n                        toChat(localize('hud.resolve.breather.used', { name, ratio }))\r\n                        await actor.update({\r\n                            'system.attributes.hp.sp.value': sp.max,\r\n                            'system.resources.resolve.value': resolve.value - 1,\r\n                        })\r\n                    } else {\r\n                        toChat(game.i18n.format('PF2E.Actions.SteelYourResolve.RecoverStamina', { name, ratio }))\r\n                        const newSP = sp.value + Math.floor(sp.max / 2)\r\n                        await actor.update({\r\n                            'system.attributes.hp.sp.value': Math.min(newSP, sp.max),\r\n                            'system.resources.resolve.value': resolve.value - 1,\r\n                        })\r\n                    }\r\n                },\r\n            },\r\n            no: {\r\n                icon: \"<i class='fas fa-times'></i>\",\r\n                label: localize('hud.resolve.no'),\r\n            },\r\n        },\r\n    }).render(true)\r\n}\r\n", "export function getDamageRollClass() {\r\n    return CONFIG.Dice.rolls.find(Roll => Roll.name === 'DamageRoll')\r\n}\r\n\r\nexport function getDamageInstanceClass() {\r\n    return CONFIG.Dice.rolls.find(Roll => Roll.name === 'DamageInstance')\r\n}\r\n\r\nexport function getChatMessageClass() {\r\n    return CONFIG.ChatMessage.documentClass\r\n}\r\n\r\nexport function getMeasuredTemplateDocumentClass() {\r\n    return CONFIG.MeasuredTemplate.documentClass\r\n}\r\n\r\nexport function getMeasuredTemplateObjectClass() {\r\n    return CONFIG.MeasuredTemplate.objectClass\r\n}\r\n", "/**\r\n * Those are directly copied from the PF2e system because they are not accesible to us in the global\r\n */\r\n\r\nconst dcAdjustments = new Map([\r\n    ['incredibly-easy', -10],\r\n    ['very-easy', -5],\r\n    ['easy', -2],\r\n    ['normal', 0],\r\n    ['hard', 2],\r\n    ['very-hard', 5],\r\n    ['incredibly-hard', 10],\r\n])\r\n\r\nconst dcByLevel = new Map([\r\n    [-1, 13],\r\n    [0, 14],\r\n    [1, 15],\r\n    [2, 16],\r\n    [3, 18],\r\n    [4, 19],\r\n    [5, 20],\r\n    [6, 22],\r\n    [7, 23],\r\n    [8, 24],\r\n    [9, 26],\r\n    [10, 27],\r\n    [11, 28],\r\n    [12, 30],\r\n    [13, 31],\r\n    [14, 32],\r\n    [15, 34],\r\n    [16, 35],\r\n    [17, 36],\r\n    [18, 38],\r\n    [19, 39],\r\n    [20, 40],\r\n    [21, 42],\r\n    [22, 44],\r\n    [23, 46],\r\n    [24, 48],\r\n    [25, 50],\r\n])\r\n\r\nfunction adjustDC(dc, adjustment = 'normal') {\r\n    return dc + (dcAdjustments.get(adjustment) ?? 0)\r\n}\r\n\r\nfunction rarityToDCAdjustment(rarity = 'common') {\r\n    switch (rarity) {\r\n        case 'uncommon':\r\n            return 'hard'\r\n        case 'rare':\r\n            return 'very-hard'\r\n        case 'unique':\r\n            return 'incredibly-hard'\r\n        default:\r\n            return 'normal'\r\n    }\r\n}\r\n\r\nexport function adjustDCByRarity(dc, rarity = 'common') {\r\n    return adjustDC(dc, rarityToDCAdjustment(rarity))\r\n}\r\n\r\nexport function calculateDC(level, { proficiencyWithoutLevel, rarity = 'common' } = {}) {\r\n    proficiencyWithoutLevel ??= game.settings.get('pf2e', 'proficiencyVariant')\r\n\r\n    const dc = dcByLevel.get(level) ?? 14\r\n    if (proficiencyWithoutLevel) {\r\n        return adjustDCByRarity(dc - Math.max(level, 0), rarity)\r\n    } else {\r\n        return adjustDCByRarity(dc, rarity)\r\n    }\r\n}\r\n", "export function htmlQueryAll(parent, selectors) {\r\n    if (!(parent instanceof Element || parent instanceof Document)) return []\r\n    return Array.from(parent.querySelectorAll(selectors))\r\n}\r\n\r\nexport function htmlClosest(child, selectors) {\r\n    if (!(child instanceof Element)) return null\r\n    return child.closest(selectors)\r\n}\r\n", "/**\r\n * Those are directly copied from the PF2e system because they are not accesible to us in the global\r\n */\r\n\r\nimport { R } from './remeda'\r\n\r\nconst actionImgMap = {\r\n    0: 'systems/pf2e/icons/actions/FreeAction.webp',\r\n    free: 'systems/pf2e/icons/actions/FreeAction.webp',\r\n    1: 'systems/pf2e/icons/actions/OneAction.webp',\r\n    2: 'systems/pf2e/icons/actions/TwoActions.webp',\r\n    3: 'systems/pf2e/icons/actions/ThreeActions.webp',\r\n    '1 or 2': 'systems/pf2e/icons/actions/OneTwoActions.webp',\r\n    '1 to 3': 'systems/pf2e/icons/actions/OneThreeActions.webp',\r\n    '2 or 3': 'systems/pf2e/icons/actions/TwoThreeActions.webp',\r\n    reaction: 'systems/pf2e/icons/actions/Reaction.webp',\r\n    passive: 'systems/pf2e/icons/actions/Passive.webp',\r\n}\r\n\r\nconst actionGlyphMap = {\r\n    0: 'F',\r\n    free: 'F',\r\n    1: 'A',\r\n    2: 'D',\r\n    3: 'T',\r\n    '1 or 2': 'A/D',\r\n    '1 to 3': 'A - T',\r\n    '2 or 3': 'D/T',\r\n    reaction: 'R',\r\n}\r\n\r\nexport function getActionIcon(action, fallback = 'systems/pf2e/icons/actions/Empty.webp') {\r\n    if (action === null) return actionImgMap['passive']\r\n    const value = typeof action !== 'object' ? action : action.type === 'action' ? action.value : action.type\r\n    const sanitized = String(value ?? '')\r\n        .toLowerCase()\r\n        .trim()\r\n    return actionImgMap[sanitized] ?? fallback\r\n}\r\n\r\nexport function getActionGlyph(action) {\r\n    if (!action && action !== 0) return ''\r\n\r\n    const value = typeof action !== 'object' ? action : action.type === 'action' ? action.value : action.type\r\n    const sanitized = String(value ?? '')\r\n        .toLowerCase()\r\n        .trim()\r\n\r\n    return actionGlyphMap[sanitized] ?? ''\r\n}\r\n\r\nexport function ErrorPF2e(message) {\r\n    return Error(`PF2e System | ${message}`)\r\n}\r\n\r\nexport function getSelectedOrOwnActors(types, useOwnCharacter = true) {\r\n    return R.uniq(\r\n        game.user\r\n            .getActiveTokens()\r\n            .filter(t => types.length === 0 || t.actor?.isOfType(...types))\r\n            .flatMap(t => t.actor ?? [])\r\n    )\r\n}\r\n\r\nexport function tupleHasValue(array, value) {\r\n    return array.includes(value)\r\n}\r\n\r\nexport function objectHasKey(obj, key) {\r\n    return (typeof key === 'string' || typeof key === 'number') && key in obj\r\n}\r\n\r\nconst wordCharacter = String.raw`[\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Join_Control}]`\r\nconst nonWordCharacter = String.raw`[^\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Join_Control}]`\r\nconst nonWordCharacterRE = new RegExp(nonWordCharacter, 'gu')\r\n\r\nconst wordBoundary = String.raw`(?:${wordCharacter})(?=${nonWordCharacter})|(?:${nonWordCharacter})(?=${wordCharacter})`\r\nconst nonWordBoundary = String.raw`(?:${wordCharacter})(?=${wordCharacter})`\r\nconst lowerCaseLetter = String.raw`\\p{Lowercase_Letter}`\r\nconst upperCaseLetter = String.raw`\\p{Uppercase_Letter}`\r\nconst lowerCaseThenUpperCaseRE = new RegExp(`(${lowerCaseLetter})(${upperCaseLetter}${nonWordBoundary})`, 'gu')\r\n\r\nconst nonWordCharacterHyphenOrSpaceRE = /[^-\\p{White_Space}\\p{Alphabetic}\\p{Mark}\\p{Decimal_Number}\\p{Join_Control}]/gu\r\nconst upperOrWordBoundariedLowerRE = new RegExp(`${upperCaseLetter}|(?:${wordBoundary})${lowerCaseLetter}`, 'gu')\r\n\r\n/**\r\n * The system's sluggification algorithm for labels and other terms.\r\n * @param text The text to sluggify\r\n * @param [options.camel=null] The sluggification style to use\r\n */\r\nexport function sluggify(text, { camel = null } = {}) {\r\n    // Sanity check\r\n    if (typeof text !== 'string') {\r\n        console.warn('Non-string argument passed to `sluggify`')\r\n        return ''\r\n    }\r\n\r\n    // A hyphen by its lonesome would be wiped: return it as-is\r\n    if (text === '-') return text\r\n\r\n    switch (camel) {\r\n        case null:\r\n            return text\r\n                .replace(lowerCaseThenUpperCaseRE, '$1-$2')\r\n                .toLowerCase()\r\n                .replace(/['\u2019]/g, '')\r\n                .replace(nonWordCharacterRE, ' ')\r\n                .trim()\r\n                .replace(/[-\\s]+/g, '-')\r\n        case 'bactrian': {\r\n            const dromedary = sluggify(text, { camel: 'dromedary' })\r\n            return dromedary.charAt(0).toUpperCase() + dromedary.slice(1)\r\n        }\r\n        case 'dromedary':\r\n            return text\r\n                .replace(nonWordCharacterHyphenOrSpaceRE, '')\r\n                .replace(/[-_]+/g, ' ')\r\n                .replace(upperOrWordBoundariedLowerRE, (part, index) => (index === 0 ? part.toLowerCase() : part.toUpperCase()))\r\n                .replace(/\\s+/g, '')\r\n        default:\r\n            throw ErrorPF2e(\"I don't think that's a real camel.\")\r\n    }\r\n}\r\n\r\n/**\r\n * Given an array and a key function, create a map where the key is the value that\r\n * gets returned when each item is pushed into the function. Accumulate\r\n * items in an array that have the same key\r\n * @param array\r\n * @param criterion\r\n * @return\r\n */\r\nexport function groupBy(array, criterion) {\r\n    const result = new Map()\r\n    for (const elem of array) {\r\n        const key = criterion(elem)\r\n        const group = result.get(key)\r\n        if (group) {\r\n            group.push(elem)\r\n        } else {\r\n            result.set(key, [elem])\r\n        }\r\n    }\r\n    return result\r\n}\r\n\r\nexport function sortBy(mapping) {\r\n    return (a, b) => {\r\n        const value1 = mapping(a)\r\n        const value2 = mapping(b)\r\n        return value1 < value2 ? -1 : value1 === value2 ? 0 : 1\r\n    }\r\n}\r\n\r\nexport function sum(values) {\r\n    return values.reduce((a, b) => a + b, 0)\r\n}\r\n\r\nexport function setHasElement(set, value) {\r\n    return set.has(value)\r\n}\r\n\r\nexport function traitSlugToObject(trait, dictionary) {\r\n    // Look up trait labels from `npcAttackTraits` instead of `weaponTraits` in case a battle form attack is\r\n    // in use, which can include what are normally NPC-only traits\r\n    const traitObject = {\r\n        name: trait,\r\n        label: game.i18n.localize(dictionary[trait] ?? trait),\r\n    }\r\n    if (objectHasKey(CONFIG.PF2E.traitsDescriptions, trait)) {\r\n        traitObject.description = CONFIG.PF2E.traitsDescriptions[trait]\r\n    }\r\n\r\n    return traitObject\r\n}\r\n\r\nexport function ordinalString(value) {\r\n    const pluralRules = new Intl.PluralRules(game.i18n.lang, { type: 'ordinal' })\r\n    const suffix = game.i18n.localize(`PF2E.OrdinalSuffixes.${pluralRules.select(value)}`)\r\n    return game.i18n.format('PF2E.OrdinalNumber', { value, suffix })\r\n}\r\n", "function isRelevantEvent(event) {\r\n    return !!event && 'ctrlKey' in event && 'metaKey' in event && 'shiftKey' in event\r\n}\r\n\r\nexport function eventToRollParams(event, rollType) {\r\n    const key = rollType.type === 'check' ? 'showCheckDialogs' : 'showDamageDialogs'\r\n    const skipDefault = !game.user.settings[key]\r\n    if (!isRelevantEvent(event)) return { skipDialog: skipDefault }\r\n\r\n    const params = { skipDialog: event.shiftKey ? !skipDefault : skipDefault }\r\n    if (event.ctrlKey || event.metaKey) {\r\n        params.rollMode = game.user.isGM ? 'gmroll' : 'blindroll'\r\n    }\r\n\r\n    return params\r\n}\r\n", "import { isInstanceOf } from '../module.js'\r\nimport { getChatMessageClass } from './classes.js'\r\nimport { calculateDC } from './dc.js'\r\nimport { htmlClosest, htmlQueryAll } from './dom.js'\r\nimport { ErrorPF2e, getActionGlyph, objectHasKey, sluggify, tupleHasValue } from './misc.js'\r\nimport { eventToRollParams } from './scripts.js'\r\n\r\nconst SAVE_TYPES = ['fortitude', 'reflex', 'will']\r\n\r\nconst inlineSelector = ['action', 'check', 'effect-area'].map(keyword => `[data-pf2-${keyword}]`).join(',')\r\n\r\nfunction injectRepostElement(links, foundryDoc) {\r\n    for (const link of links) {\r\n        if (!foundryDoc || foundryDoc.isOwner) link.classList.add('with-repost')\r\n\r\n        const repostButtons = htmlQueryAll(link, 'i[data-pf2-repost]')\r\n        if (repostButtons.length > 0) {\r\n            if (foundryDoc && !foundryDoc.isOwner) {\r\n                for (const button of repostButtons) {\r\n                    button.remove()\r\n                }\r\n                link.classList.remove('with-repost')\r\n            }\r\n            continue\r\n        }\r\n\r\n        if (foundryDoc && !foundryDoc.isOwner) continue\r\n\r\n        const newButton = document.createElement('i')\r\n        const icon = link.parentElement?.dataset?.pf2Checkgroup !== undefined ? 'fa-comment-alt-dots' : 'fa-comment-alt'\r\n        newButton.classList.add('fa-solid', icon)\r\n        newButton.dataset.pf2Repost = ''\r\n        newButton.title = game.i18n.localize('PF2E.Repost')\r\n        link.appendChild(newButton)\r\n\r\n        newButton.addEventListener('click', event => {\r\n            event.stopPropagation()\r\n            const target = event.target\r\n            if (!(target instanceof HTMLElement)) return\r\n            const parent = target?.parentElement\r\n            if (!parent) return\r\n\r\n            const document = resolveDocument(target, foundryDoc)\r\n            repostAction(parent, document)\r\n        })\r\n    }\r\n}\r\n\r\nfunction flavorDamageRolls(html, actor = null) {\r\n    for (const rollLink of htmlQueryAll(html, 'a.inline-roll[data-damage-roll]')) {\r\n        const itemId = htmlClosest(rollLink, '[data-item-id]')?.dataset.itemId\r\n        const item = actor?.items.get(itemId ?? '')\r\n        if (item) rollLink.dataset.flavor ||= item.name\r\n    }\r\n}\r\n\r\nfunction makeRepostHtml(target, defaultVisibility) {\r\n    const flavor = target.attributes.getNamedItem('data-pf2-repost-flavor')?.value ?? ''\r\n    const showDC = target.attributes.getNamedItem('data-pf2-show-dc')?.value ?? defaultVisibility\r\n    return `<span data-visibility=\"${showDC}\">${flavor}</span> ${target.outerHTML}`.trim()\r\n}\r\n\r\nfunction repostAction(target, foundryDoc = null) {\r\n    if (!['pf2Action', 'pf2Check', 'pf2EffectArea'].some(d => d in target.dataset)) {\r\n        return\r\n    }\r\n\r\n    const actor = resolveActor(foundryDoc, target)\r\n    const defaultVisibility = (actor ?? foundryDoc)?.hasPlayerOwner ? 'all' : 'gm'\r\n    const content = (() => {\r\n        if (target.parentElement?.dataset?.pf2Checkgroup !== undefined) {\r\n            const content = htmlQueryAll(target.parentElement, inlineSelector)\r\n                .map(target => makeRepostHtml(target, defaultVisibility))\r\n                .join('<br>')\r\n\r\n            return `<div data-pf2-checkgroup>${content}</div>`\r\n        } else {\r\n            return makeRepostHtml(target, defaultVisibility)\r\n        }\r\n    })()\r\n\r\n    const ChatMessagePF2e = getChatMessageClass()\r\n    const speaker = actor\r\n        ? ChatMessagePF2e.getSpeaker({ actor, token: actor.getActiveTokens(false, true).shift() })\r\n        : ChatMessagePF2e.getSpeaker()\r\n\r\n    // If the originating document is a journal entry, include its UUID as a flag. If a chat message, copy over\r\n    // the origin flag.\r\n    const message = game.messages.get(htmlClosest(target, '[data-message-id]')?.dataset.messageId ?? '')\r\n    const flags =\r\n        foundryDoc instanceof JournalEntry\r\n            ? { pf2e: { journalEntry: foundryDoc.uuid } }\r\n            : message?.flags.pf2e.origin\r\n            ? { pf2e: { origin: deepClone(message.flags.pf2e.origin) } }\r\n            : {}\r\n\r\n    ChatMessagePF2e.create({\r\n        speaker,\r\n        content,\r\n        flags,\r\n    })\r\n}\r\n\r\n/**\r\n * actions & checks use the actor directly instead of selections\r\n */\r\nexport function listenInlineRoll(html, foundryDoc) {\r\n    foundryDoc ??= resolveDocument(html, foundryDoc)\r\n\r\n    const links = htmlQueryAll(html, inlineSelector).filter(l => ['A', 'SPAN'].includes(l.nodeName))\r\n    injectRepostElement(links, foundryDoc)\r\n\r\n    flavorDamageRolls(html, foundryDoc instanceof Actor ? foundryDoc : null)\r\n\r\n    for (const link of links.filter(l => l.dataset.pf2Action)) {\r\n        const { pf2Action, pf2Glyph, pf2Variant, pf2Dc, pf2ShowDc, pf2Skill } = link.dataset\r\n        link.addEventListener('click', event => {\r\n            const action = game.pf2e.actions[pf2Action ? sluggify(pf2Action, { camel: 'dromedary' }) : '']\r\n            const visibility = pf2ShowDc ?? 'all'\r\n            if (pf2Action && action) {\r\n                action({\r\n                    event,\r\n                    glyph: pf2Glyph,\r\n                    variant: pf2Variant,\r\n                    difficultyClass: pf2Dc ? { scope: 'check', value: Number(pf2Dc) || 0, visibility } : undefined,\r\n                    skill: pf2Skill,\r\n                })\r\n            } else {\r\n                console.warn(`PF2e System | Skip executing unknown action '${pf2Action}'`)\r\n            }\r\n        })\r\n    }\r\n\r\n    for (const link of links.filter(l => l.dataset.pf2Check && !l.dataset.invalid)) {\r\n        const { pf2Check, pf2Dc, pf2Traits, pf2Label, pf2Defense, pf2Adjustment, pf2Roller, pf2RollOptions } = link.dataset\r\n\r\n        if (!pf2Check) return\r\n\r\n        link.addEventListener('click', async event => {\r\n            const parent = resolveActor(foundryDoc, link)\r\n            const actors = [parent]\r\n            const extraRollOptions = [\r\n                ...(pf2Traits?.split(',').map(o => o.trim()) ?? []),\r\n                ...(pf2RollOptions?.split(',').map(o => o.trim()) ?? []),\r\n            ]\r\n            const eventRollParams = eventToRollParams(event, { type: 'check' })\r\n\r\n            switch (pf2Check) {\r\n                case 'flat': {\r\n                    for (const actor of actors) {\r\n                        const flatCheck = new Statistic(actor, {\r\n                            label: '',\r\n                            slug: 'flat',\r\n                            modifiers: [],\r\n                            check: { type: 'flat-check' },\r\n                        })\r\n                        const dc = Number.isInteger(Number(pf2Dc)) ? { label: pf2Label, value: Number(pf2Dc) } : null\r\n                        flatCheck.roll({ ...eventRollParams, extraRollOptions, dc })\r\n                    }\r\n                    break\r\n                }\r\n                default: {\r\n                    const isSavingThrow = tupleHasValue(SAVE_TYPES, pf2Check)\r\n\r\n                    // Get actual traits for display in chat cards\r\n                    const traits = isSavingThrow ? [] : extraRollOptions.filter(t => t in CONFIG.PF2E.actionTraits) ?? []\r\n\r\n                    for (const actor of actors) {\r\n                        const statistic = (() => {\r\n                            if (pf2Check in CONFIG.PF2E.magicTraditions) {\r\n                                const bestSpellcasting =\r\n                                    actor.spellcasting\r\n                                        .filter(c => c.tradition === pf2Check)\r\n                                        .flatMap(s => s.statistic ?? [])\r\n                                        .sort((a, b) => b.check.mod - a.check.mod)\r\n                                        .shift() ?? null\r\n                                if (bestSpellcasting) return bestSpellcasting\r\n                            }\r\n                            return actor.getStatistic(pf2Check)\r\n                        })()\r\n\r\n                        if (!statistic) {\r\n                            console.warn(ErrorPF2e(`Skip rolling unknown statistic ${pf2Check}`).message)\r\n                            continue\r\n                        }\r\n\r\n                        const targetActor = pf2Defense ? game.user.targets.first()?.actor : null\r\n\r\n                        const dcValue = (() => {\r\n                            const adjustment = Number(pf2Adjustment) || 0\r\n                            if (pf2Dc === '@self.level') {\r\n                                return calculateDC(actor.level) + adjustment\r\n                            }\r\n                            return Number(pf2Dc ?? 'NaN') + adjustment\r\n                        })()\r\n\r\n                        const dc = (() => {\r\n                            if (Number.isInteger(dcValue)) {\r\n                                return { label: pf2Label, value: dcValue }\r\n                            } else if (pf2Defense) {\r\n                                const defenseStat = targetActor?.getStatistic(pf2Defense)\r\n                                return defenseStat\r\n                                    ? {\r\n                                          statistic: defenseStat.dc,\r\n                                          scope: 'check',\r\n                                          value: defenseStat.dc.value,\r\n                                      }\r\n                                    : null\r\n                            }\r\n                            return null\r\n                        })()\r\n\r\n                        // Retrieve the item if:\r\n                        // (2) The item is an action or,\r\n                        // (1) The check is a saving throw and the item is not a weapon.\r\n                        // Exclude weapons so that roll notes on strikes from incapacitation abilities continue to work.\r\n                        const item = (() => {\r\n                            const itemFromDoc =\r\n                                foundryDoc instanceof Item\r\n                                    ? foundryDoc\r\n                                    : foundryDoc instanceof ChatMessage\r\n                                    ? foundryDoc.item\r\n                                    : null\r\n\r\n                            return itemFromDoc?.isOfType('action', 'feat', 'campaignFeature') ||\r\n                                (isSavingThrow && !itemFromDoc?.isOfType('weapon'))\r\n                                ? itemFromDoc\r\n                                : null\r\n                        })()\r\n\r\n                        const args = {\r\n                            ...eventRollParams,\r\n                            extraRollOptions,\r\n                            origin: isSavingThrow && parent instanceof Actor ? parent : null,\r\n                            dc,\r\n                            target: !isSavingThrow && dc?.statistic ? targetActor : null,\r\n                            item,\r\n                            traits,\r\n                        }\r\n\r\n                        // Use a special header for checks against defenses\r\n                        const itemIsEncounterAction = !!(item?.isOfType('action', 'feat') && item.actionCost)\r\n                        if (itemIsEncounterAction && pf2Defense) {\r\n                            const subtitleLocKey =\r\n                                pf2Check in CONFIG.PF2E.magicTraditions\r\n                                    ? 'PF2E.ActionsCheck.spell'\r\n                                    : statistic.check.type === 'attack-roll'\r\n                                    ? 'PF2E.ActionsCheck.x-attack-roll'\r\n                                    : 'PF2E.ActionsCheck.x'\r\n                            args.label = await renderTemplate('systems/pf2e/templates/chat/action/header.hbs', {\r\n                                glyph: getActionGlyph(item.actionCost),\r\n                                subtitle: game.i18n.format(subtitleLocKey, { type: statistic.label }),\r\n                                title: item.name,\r\n                            })\r\n                        }\r\n\r\n                        statistic.roll(args)\r\n                    }\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n    const templateConversion = {\r\n        burst: 'circle',\r\n        cone: 'cone',\r\n        cube: 'rect',\r\n        emanation: 'circle',\r\n        line: 'ray',\r\n        rect: 'rect',\r\n        square: 'rect',\r\n    }\r\n\r\n    for (const link of links.filter(l => l.hasAttribute('data-pf2-effect-area'))) {\r\n        const { pf2EffectArea, pf2Distance, pf2TemplateData, pf2Traits, pf2Width } = link.dataset\r\n        link.addEventListener('click', () => {\r\n            if (!canvas.ready) return\r\n\r\n            if (typeof pf2EffectArea !== 'string') {\r\n                console.warn(`PF2e System | Could not create template'`)\r\n                return\r\n            }\r\n\r\n            const templateData = JSON.parse(pf2TemplateData ?? '{}')\r\n            templateData.distance ||= Number(pf2Distance)\r\n            templateData.fillColor ||= game.user.color\r\n            templateData.t = templateConversion[pf2EffectArea]\r\n\r\n            switch (templateData.t) {\r\n                case 'ray':\r\n                    templateData.width =\r\n                        Number(pf2Width) || CONFIG.MeasuredTemplate.defaults.width * (canvas.dimensions?.distance ?? 1)\r\n                    break\r\n                case 'cone':\r\n                    templateData.angle = CONFIG.MeasuredTemplate.defaults.angle\r\n                    break\r\n                case 'rect': {\r\n                    const distance = templateData.distance ?? 0\r\n                    templateData.distance = Math.hypot(distance, distance)\r\n                    templateData.width = distance\r\n                    templateData.direction = 45\r\n                    break\r\n                }\r\n            }\r\n\r\n            const flags = {\r\n                pf2e: {},\r\n            }\r\n\r\n            if (\r\n                objectHasKey(CONFIG.PF2E.areaTypes, pf2EffectArea) &&\r\n                objectHasKey(CONFIG.PF2E.areaSizes, templateData.distance)\r\n            ) {\r\n                flags.pf2e.areaType = pf2EffectArea\r\n            }\r\n\r\n            const messageId = isInstanceOf(foundryDoc, 'ChatMessagePF2e')\r\n                ? foundryDoc.id\r\n                : htmlClosest(html, '[data-message-id]')?.dataset.messageId ?? null\r\n            if (messageId) {\r\n                flags.pf2e.messageId = messageId\r\n            }\r\n\r\n            const actor = resolveActor(foundryDoc, link)\r\n            if (actor || pf2Traits) {\r\n                const origin = {}\r\n                if (actor) {\r\n                    origin.actor = actor.uuid\r\n                }\r\n                if (pf2Traits) {\r\n                    origin.traits = pf2Traits.split(',')\r\n                }\r\n                flags.pf2e.origin = origin\r\n            }\r\n\r\n            if (!isEmpty(flags.pf2e)) {\r\n                templateData.flags = flags\r\n            }\r\n\r\n            canvas.templates.createPreview(templateData)\r\n        })\r\n    }\r\n\r\n    for (const link of html.querySelectorAll('a[data-damage-roll]')) {\r\n        link.dataset.itemUuid = foundryDoc.uuid\r\n    }\r\n}\r\n\r\n/** If the provided document exists returns it, otherwise attempt to derive it from the sheet */\r\nfunction resolveDocument(html, foundryDoc) {\r\n    if (foundryDoc) return foundryDoc\r\n\r\n    const sheet = ui.windows[Number(html.closest('.app.sheet')?.dataset.appid)] ?? null\r\n\r\n    const document = sheet?.document\r\n    return document instanceof Actor || document instanceof JournalEntry ? document : null\r\n}\r\n\r\n/** Retrieves the actor for the given document, or the document itself if its already an actor */\r\nfunction resolveActor(foundryDoc, anchor) {\r\n    if (isInstanceOf(foundryDoc, 'ActorPF2e')) return foundryDoc\r\n    if (isInstanceOf(foundryDoc, 'ItemPF2e') || isInstanceOf(foundryDoc, 'ChatMessagePF2e')) return foundryDoc.actor\r\n\r\n    // Retrieve item/actor from anywhere via UUID\r\n    const itemUuid = anchor.dataset.itemUuid\r\n    const itemByUUID = itemUuid && !itemUuid.startsWith('Compendium.') ? fromUuidSync(itemUuid) : null\r\n    return itemByUUID instanceof Item ? itemByUUID.actor : null\r\n}\r\n", "import { getFlag, localize, setFlag } from './module.js'\r\nimport { listenInlineRoll } from './pf2e/inline-roll.js'\r\n\r\nexport const RANKS = ['U', 'T', 'E', 'M', 'L']\r\n\r\nconst COVER_UUID = 'Compendium.pf2e.other-effects.Item.I9lfZUiCwMiGogVi'\r\n\r\nexport async function getItemSummary(el, actor) {\r\n    const dataset = el.data()\r\n    const item = dataset.itemId ? actor.items.get(dataset.itemId) : await fromUuid(dataset.uuid)\r\n    const data = await item?.getChatData({ secrets: actor.isOwner }, dataset)\r\n    if (!data) return\r\n\r\n    const description = document.createElement('div')\r\n    description.classList.add('description')\r\n\r\n    await actor.sheet.itemRenderer.renderItemSummary(description, item, data)\r\n    listenInlineRoll(description, item)\r\n\r\n    return description\r\n}\r\n\r\nexport function addNameTooltipListeners(el) {\r\n    const targetEl = el.find('.name')\r\n\r\n    targetEl.on('mouseenter', event => {\r\n        event.preventDefault()\r\n\r\n        const target = event.currentTarget\r\n        const { width } = target.getBoundingClientRect()\r\n        if (target.scrollWidth <= Math.ceil(width)) return\r\n\r\n        const name = target.innerHTML.trim()\r\n        game.tooltip.activate(event.currentTarget, { text: name, direction: TooltipManager.TOOLTIP_DIRECTIONS.UP })\r\n    })\r\n\r\n    targetEl.on('mouseleave', event => {\r\n        event.preventDefault()\r\n        game.tooltip.deactivate()\r\n    })\r\n\r\n    targetEl.on('mousedown', event => {\r\n        game.tooltip.deactivate()\r\n    })\r\n}\r\n\r\nexport function editItem(event, actor) {\r\n    event.preventDefault()\r\n    const item = getItemFromEvent(event, actor)\r\n    item?.sheet.render(true, { focus: true })\r\n}\r\n\r\nexport async function deleteItem(event, actor) {\r\n    event.preventDefault()\r\n\r\n    const item = getItemFromEvent(event, actor)\r\n    if (!item) return\r\n\r\n    if (event.ctrlKey) return item.delete()\r\n\r\n    new Dialog({\r\n        title: localize('deleteItem.title'),\r\n        content: `<p>${game.i18n.format('PF2E.DeleteQuestion', { name: item.name })}</p>`,\r\n        buttons: {\r\n            ok: {\r\n                icon: '<i class=\"fa-solid fa-trash\"></i>',\r\n                label: localize('deleteItem.ok'),\r\n                callback: () => item.delete(),\r\n            },\r\n            cancel: {\r\n                icon: '<i class=\"fas fa-times\"></i>',\r\n                label: localize('deleteItem.cancel'),\r\n            },\r\n        },\r\n    }).render(true)\r\n}\r\n\r\nexport function getItemFromEvent(event, actor) {\r\n    const { itemId } = event.currentTarget.closest('[data-item-id]').dataset\r\n    return actor.items.get(itemId)\r\n}\r\n\r\nexport function getMacros(actor) {\r\n    return actor.isOwner\r\n        ? getFlag(actor, `macros.${game.user.id}`)\r\n              ?.map(uuid => {\r\n                  const macro = fromUuidSync(uuid)\r\n                  if (!macro) return null\r\n                  return { img: macro.img, name: macro.name, uuid }\r\n              })\r\n              .filter(Boolean)\r\n        : undefined\r\n}\r\n\r\nexport function onDroppedMacro(event, actor) {\r\n    const { type, uuid } = TextEditor.getDragEventData(event.originalEvent) ?? {}\r\n    if (type !== 'Macro' || !fromUuidSync(uuid)) return\r\n\r\n    const flag = `macros.${game.user.id}`\r\n    const macros = getFlag(actor, flag)?.slice() ?? []\r\n    if (macros.includes(uuid)) return\r\n\r\n    macros.push(uuid)\r\n    setFlag(actor, flag, macros)\r\n}\r\n\r\nexport function deleteMacro(event, actor) {\r\n    const flag = `macros.${game.user.id}`\r\n    const macros = getFlag(actor, flag)?.slice()\r\n    if (!macros?.length) return\r\n\r\n    const { uuid } = event.currentTarget.closest('.macro').dataset\r\n    const index = macros.indexOf(uuid)\r\n    if (index === -1) return\r\n\r\n    macros.splice(index, 1)\r\n    setFlag(actor, flag, macros)\r\n}\r\n\r\nexport function getUniqueTarget(condition = () => true) {\r\n    const targets = game.user.targets\r\n    const target = targets.size === 1 ? targets.first() : null\r\n    return target && condition(target) ? target : null\r\n}\r\n\r\nexport function filterIn(value, filter) {\r\n    if (!filter) return true\r\n    return value.toLowerCase().includes(filter)\r\n}\r\n\r\nexport function localeCompare(a, b) {\r\n    return a.localeCompare(b, game.i18n.lang)\r\n}\r\n\r\nexport function getCoverEffect(actor) {\r\n    return actor?.itemTypes.effect.find(effect => effect.flags.core?.sourceId === COVER_UUID)\r\n}\r\n", "import { enrichHTML, getHud, localize } from './module.js'\r\nimport { getItemSummary } from './shared.js'\r\n\r\nexport async function popup(title, content, actor) {\r\n    const hud = getHud()\r\n    const el = hud?.element\r\n    if (!el) return\r\n\r\n    el.find('> .popup').remove()\r\n\r\n    const tmp = document.createElement('div')\r\n    tmp.innerHTML = `<div class=\"popup\">\r\n    <div class=\"header\">\r\n        <div class=\"title\">${title}</div>\r\n        <a class=\"observable\" data-action=\"close-popup\"><i class=\"fas fa-times\"></i> ${localize('popup.close')}</a>\r\n    </div>\r\n</div>`\r\n\r\n    const popup = tmp.firstElementChild\r\n    if (typeof content === 'string') {\r\n        content = await enrichHTML(content, actor)\r\n        popup.insertAdjacentHTML('beforeend', content)\r\n    } else {\r\n        popup.append(content)\r\n    }\r\n\r\n    popup.querySelector('[data-action=close-popup]').addEventListener('click', () => popup.remove())\r\n\r\n    el.append(popup)\r\n    hud.lock()\r\n}\r\n\r\nexport async function showItemSummary(el, actor, title) {\r\n    title ??= el.find('.name').html()\r\n    const description = await getItemSummary(el, actor)\r\n    if (description) popup(title.trim(), description, actor)\r\n}\r\n", "/**\r\n * This one is used to create chat message for items directly picked from compendiums\r\n * So it is not technically a direct copy/paste of the system code but a slightly rearanged version\r\n */\r\n\r\nimport { getChatMessageClass } from './classes'\r\nimport { ErrorPF2e, getActionGlyph, sluggify, traitSlugToObject } from './misc'\r\n\r\nexport async function unownedItemToMessage(event, item, actor, { rollMode = undefined, create = true, data = {} }) {\r\n    const ChatMessagePF2e = getChatMessageClass()\r\n    const template = `systems/pf2e/templates/chat/${sluggify(item.type)}-card.hbs`\r\n    const token = actor.token\r\n    const nearestItem = event?.currentTarget.closest('.item') ?? {}\r\n    const contextualData = Object.keys(data).length > 0 ? data : nearestItem.dataset || {}\r\n    const templateData = {\r\n        actor: actor,\r\n        tokenId: token ? `${token.parent?.id}.${token.id}` : null,\r\n        item: item,\r\n        data: await item.getChatData(undefined, contextualData),\r\n    }\r\n\r\n    const chatData = {\r\n        speaker: ChatMessagePF2e.getSpeaker({\r\n            actor: actor,\r\n            token: actor.getActiveTokens(false, true)[0] ?? null,\r\n        }),\r\n        flags: {\r\n            pf2e: { origin: item.getOriginData() },\r\n        },\r\n        type: CONST.CHAT_MESSAGE_TYPES.OTHER,\r\n    }\r\n\r\n    rollMode ??= event?.ctrlKey || event?.metaKey ? 'blindroll' : game.settings.get('core', 'rollMode')\r\n    if (['gmroll', 'blindroll'].includes(rollMode)) chatData.whisper = ChatMessagePF2e.getWhisperRecipients('GM').map(u => u.id)\r\n    if (rollMode === 'blindroll') chatData.blind = true\r\n\r\n    chatData.content = await renderTemplate(template, templateData)\r\n    return create ? ChatMessagePF2e.create(chatData, { renderSheet: false }) : new ChatMessagePF2e(chatData)\r\n}\r\n\r\nexport async function createSelfEffectMessage(item) {\r\n    if (!item.system.selfEffect) {\r\n        throw ErrorPF2e(\r\n            [\r\n                'Only actions with self-applied effects can be passed to `ActorPF2e#useAction`.',\r\n                'Support will be expanded at a later time.',\r\n            ].join(' ')\r\n        )\r\n    }\r\n\r\n    const { actor, actionCost } = item\r\n    const token = actor.getActiveTokens(true, true).shift() ?? null\r\n\r\n    const ChatMessagePF2e = getChatMessageClass()\r\n    const speaker = ChatMessagePF2e.getSpeaker({ actor, token })\r\n    const flavor = await renderTemplate('systems/pf2e/templates/chat/action/flavor.hbs', {\r\n        action: {\r\n            glyph: getActionGlyph(actionCost),\r\n            title: item.name,\r\n        },\r\n        item,\r\n        traits: item.system.traits.value.map(t => traitSlugToObject(t, CONFIG.PF2E.actionTraits)),\r\n    })\r\n\r\n    // Get a preview slice of the message\r\n    const previewLength = 100\r\n    const descriptionPreview = (() => {\r\n        if (item.actor.pack) return null\r\n        const tempDiv = document.createElement('div')\r\n        const documentTypes = [...CONST.DOCUMENT_LINK_TYPES, 'Compendium', 'UUID']\r\n        const linkPattern = new RegExp(`@(${documentTypes.join('|')})\\\\[([^#\\\\]]+)(?:#([^\\\\]]+))?](?:{([^}]+)})?`, 'g')\r\n        tempDiv.innerHTML = item.description.replace(linkPattern, (_match, ...args) => args[3])\r\n\r\n        return tempDiv.innerText.slice(0, previewLength)\r\n    })()\r\n    const description = {\r\n        full: descriptionPreview && descriptionPreview.length < previewLength ? item.description : null,\r\n        preview: descriptionPreview,\r\n    }\r\n    const content = await renderTemplate('systems/pf2e/templates/chat/action/self-effect.hbs', {\r\n        actor: item.actor,\r\n        description,\r\n    })\r\n    const flags = { pf2e: { context: { type: 'self-effect', item: item.id } } }\r\n\r\n    return ChatMessagePF2e.create({ speaker, flavor, content, flags })\r\n}\r\n", "/**\r\n * Those are directly copied from the PF2e system because they are not accesible to us in the global\r\n */\r\n\r\nexport async function toggleWeaponTrait({ weapon, trait, selection }) {\r\n    const current = weapon.system.traits.toggles[trait].selection\r\n    if (current === selection) return false\r\n\r\n    const item = weapon.actor?.items.get(weapon.id)\r\n    if (item?.isOfType('weapon') && item === weapon) {\r\n        await item.update({ [`system.traits.toggles.${trait}.selection`]: selection })\r\n    } else if (item?.isOfType('weapon') && weapon.altUsageType === 'melee') {\r\n        item.update({ [`system.meleeUsage.traitToggles.${trait}`]: selection })\r\n    } else if (trait === 'versatile' && item?.isOfType('shield')) {\r\n        item.update({ 'system.traits.integrated.versatile.selection': selection })\r\n    } else {\r\n        const rule = item?.rules.find(r => r.key === 'Strike' && !r.ignored && r.slug === weapon.slug)\r\n        await rule?.toggleTrait({ trait, selection })\r\n    }\r\n\r\n    return true\r\n}\r\n", "/**\r\n * Those are copied from the PF2e system because they are not accesible to us in the global\r\n * adjusted to be independent function\r\n */\r\n\r\nexport const DEGREE_OF_SUCCESS = {\r\n    CRITICAL_FAILURE: 0,\r\n    FAILURE: 1,\r\n    SUCCESS: 2,\r\n    CRITICAL_SUCCESS: 3,\r\n}\r\n\r\nconst DEGREE_ADJUSTMENT_AMOUNTS = {\r\n    LOWER_BY_TWO: -2,\r\n    LOWER: -1,\r\n    INCREASE: 1,\r\n    INCREASE_BY_TWO: 2,\r\n    TO_CRITICAL_FAILURE: 'criticalFailure',\r\n    TO_FAILURE: 'failure',\r\n    TO_SUCCESS: 'success',\r\n    TO_CRITICAL_SUCCESS: 'criticalSuccess',\r\n}\r\n\r\nfunction adjustDegreeOfSuccess(amount, degreeOfSuccess) {\r\n    switch (amount) {\r\n        case 'criticalFailure':\r\n            return 0\r\n        case 'failure':\r\n            return 1\r\n        case 'success':\r\n            return 2\r\n        case 'criticalSuccess':\r\n            return 3\r\n        default:\r\n            return Math.clamped(degreeOfSuccess + amount, 0, 3)\r\n    }\r\n}\r\n\r\nfunction adjustDegreeByDieValue(dieResult, degree) {\r\n    if (dieResult === 20) {\r\n        return adjustDegreeOfSuccess(DEGREE_ADJUSTMENT_AMOUNTS.INCREASE, degree)\r\n    } else if (dieResult === 1) {\r\n        return adjustDegreeOfSuccess(DEGREE_ADJUSTMENT_AMOUNTS.LOWER, degree)\r\n    }\r\n\r\n    return degree\r\n}\r\n\r\nexport function calculateDegreeOfSuccess(rollTotal, dieResult, dc) {\r\n    if (rollTotal - dc >= 10) {\r\n        return adjustDegreeByDieValue(dieResult, DEGREE_OF_SUCCESS.CRITICAL_SUCCESS)\r\n    } else if (dc - rollTotal >= 10) {\r\n        return adjustDegreeByDieValue(dieResult, DEGREE_OF_SUCCESS.CRITICAL_FAILURE)\r\n    } else if (rollTotal >= dc) {\r\n        return adjustDegreeByDieValue(dieResult, DEGREE_OF_SUCCESS.SUCCESS)\r\n    }\r\n\r\n    return adjustDegreeByDieValue(dieResult, DEGREE_OF_SUCCESS.FAILURE)\r\n}\r\n", "import { getSetting, localize, modifier, templatePath } from '../module.js'\r\nimport { calculateDegreeOfSuccess } from '../pf2e/success.js'\r\nimport { getUniqueTarget, RANKS } from '../shared.js'\r\n\r\nconst SKILLS = ['arcana', 'crafting', 'medicine', 'nature', 'occultism', 'religion', 'society']\r\n\r\nconst SUCCESS = {\r\n    0: { icon: '<i class=\"fa-solid fa-xmark-large\"></i><i class=\"fa-solid fa-xmark-large\"></i>', name: 'criticalFailure' },\r\n    1: { icon: '<i class=\"fa-solid fa-xmark-large\"></i>', name: 'failure' },\r\n    2: { icon: '<i class=\"fa-solid fa-check\"></i>', name: 'success' },\r\n    3: { icon: '<i class=\"fa-solid fa-check\"></i><i class=\"fa-solid fa-check\"></i>', name: 'criticalSuccess' },\r\n}\r\n\r\nexport async function rollRecallKnowledges(actor) {\r\n    const roll = await new Roll('1d20').evaluate({ async: true })\r\n    const dieResult = roll.dice[0].total\r\n    const dieSuccess = dieResult === 1 ? '0' : dieResult === 20 ? '3' : ''\r\n    const lores = Object.values(actor.skills).filter(skill => skill.lore)\r\n    const target = getUniqueTarget(target => target.actor?.identificationDCs)?.actor\r\n\r\n    let data = {\r\n        dieSuccess,\r\n        dieResult,\r\n        target,\r\n        i18n: str => localize(`actions.recall-knowledge.${str}`),\r\n    }\r\n\r\n    if (target) {\r\n        const { standard, skills, lore } = target.identificationDCs\r\n\r\n        let skillsDCs = standard.progression.slice()\r\n        skillsDCs.length = 4\r\n        skillsDCs = [...skillsDCs]\r\n\r\n        const loresDCs = lore.map(({ progression }) => {\r\n            let dcs = progression\r\n            dcs.length = 6\r\n            return [...dcs]\r\n        })\r\n\r\n        data.skillsDCs = skillsDCs\r\n        data.loresDCs = loresDCs\r\n\r\n        data.skills = await Promise.all(\r\n            skills.map(slug => {\r\n                const skill = actor.skills[slug]\r\n                return rollSkill(skill, dieResult, skillsDCs)\r\n            })\r\n        )\r\n\r\n        data.lores = await Promise.all(lores.map(lore => rollSkill(lore, dieResult)))\r\n    } else {\r\n        data.skills = await Promise.all(\r\n            [...SKILLS.map(slug => actor.skills[slug]), ...lores].map(skill => rollSkill(skill, dieResult))\r\n        )\r\n    }\r\n\r\n    const rkDice = getSetting('rk-dice')\r\n\r\n    const options = {\r\n        speaker: ChatMessage.getSpeaker({ actor }),\r\n        rollMode: CONST.DICE_ROLL_MODES.BLIND,\r\n        type: CONST.CHAT_MESSAGE_TYPES.ROLL,\r\n    }\r\n\r\n    if (rkDice) {\r\n        options.rolls = [roll]\r\n        data.rkDice = true\r\n    }\r\n\r\n    options.flavor = await renderTemplate(templatePath('chat/recall-knowledge'), data)\r\n\r\n    ChatMessage.create(options)\r\n}\r\n\r\nasync function rollSkill(skill, dieResult, dcs) {\r\n    const { rank, label } = skill\r\n\r\n    const roll = await skill.roll({\r\n        createMessage: false,\r\n        skipDialog: true,\r\n        extraRollOptions: ['action:recall-knowledge'],\r\n    })\r\n\r\n    const mod = roll.total - roll.dice[0].total\r\n    const total = dieResult + mod\r\n\r\n    return {\r\n        mod,\r\n        rank,\r\n        label,\r\n        total,\r\n        modifier: modifier(mod),\r\n        rankLabel: RANKS[rank],\r\n        checks: dcs?.map(dc => {\r\n            if (!dc) return `-`\r\n            const success = calculateDegreeOfSuccess(total, dieResult, dc)\r\n            return {\r\n                success,\r\n                icon: SUCCESS[success].icon,\r\n                title: SUCCESS[success].name,\r\n            }\r\n        }),\r\n    }\r\n}\r\n", "import { getSetting, hasFeat, localize, modifier, templatePath } from '../module.js'\r\nimport { unownedItemToMessage } from '../pf2e/item.js'\r\nimport { showItemSummary } from '../popup.js'\r\nimport { filterIn, localeCompare } from '../shared.js'\r\n\r\nconst MODULE_ID = 'pf2e-token-hud'\r\n\r\nconst UNTRAINED_IMPROVISATION = 'Compendium.pf2e.feats-srd.Item.9jGaBxLUtevZYcZO'\r\n\r\nconst CROWBAR_UUIDS = new Set([\r\n    'Compendium.pf2e.equipment-srd.Item.44F1mfJei4GY8f2X',\r\n    'Compendium.pf2e.equipment-srd.Item.4kz3vhkKPUuXBpxk',\r\n])\r\nconst BON_MOT_UUID = 'Compendium.pf2e.feats-srd.Item.0GF2j54roPFIDmXf'\r\nconst NATURAL_MEDICINE_UUID = 'Compendium.pf2e.feats-srd.Item.WC4xLBGmBsdOdHWu'\r\nconst FOLLOW_THE_EXPERT_UUID = 'Compendium.pf2e.other-effects.Item.VCSpuc3Tf3XWMkd3'\r\n\r\nconst LABELS = {\r\n    initiative: 'PF2E.InitiativeLabel',\r\n    'recall-knowledge': 'PF2E.RecallKnowledge.Label',\r\n    'cover-tracks': 'PF2E.TravelSpeed.ExplorationActivities.CoverTracks',\r\n    earnIncome: `${MODULE_ID}.skills.actions.earnIncome`,\r\n    treatWounds: `${MODULE_ID}.skills.actions.treatWounds`,\r\n    'borrow-arcane-spell': `${MODULE_ID}.skills.actions.borrow-arcane-spell`,\r\n    'identify-magic': `${MODULE_ID}.skills.actions.identify-magic`,\r\n    'identify-alchemy': `${MODULE_ID}.skills.actions.identify-alchemy`,\r\n    'learn-spell': `${MODULE_ID}.skills.actions.learn-spell`,\r\n    'crafting-goods': `${MODULE_ID}.skills.actions.crafting-goods`,\r\n    'staging-performance': `${MODULE_ID}.skills.actions.staging-performance`,\r\n}\r\n\r\nconst ACTIONS_UUIDS = {\r\n    aid: 'Compendium.pf2e.actionspf2e.Item.HCl3pzVefiv9ZKQW',\r\n    'sense-motive': 'Compendium.pf2e.actionspf2e.Item.1xRFPTFtWtGJ9ELw',\r\n    seek: 'Compendium.pf2e.actionspf2e.Item.BlAOM2X92SI6HMtJ',\r\n    balance: 'Compendium.pf2e.actionspf2e.Item.M76ycLAqHoAgbcej',\r\n    escape: 'Compendium.pf2e.actionspf2e.Item.SkZAQRkLLkmBQNB9',\r\n    'follow-the-expert': 'Compendium.pf2e.actionspf2e.Item.tfa4Sh7wcxCEqL29',\r\n    'tumble-through': 'Compendium.pf2e.actionspf2e.Item.21WIfSu7Xd7uKqV8',\r\n    'maneuver-in-flight': 'Compendium.pf2e.actionspf2e.Item.Qf1ylAbdVi1rkc8M',\r\n    squeeze: 'Compendium.pf2e.actionspf2e.Item.kMcV8e5EZUxa6evt',\r\n    'recall-knowledge': 'Compendium.pf2e.actionspf2e.Item.1OagaWtBpVXExToo',\r\n    'borrow-arcane-spell': 'Compendium.pf2e.actionspf2e.Item.OizxuPb44g3eHPFh',\r\n    'decipher-writing': 'Compendium.pf2e.actionspf2e.Item.d9gbpiQjChYDYA2L',\r\n    'identify-magic': 'Compendium.pf2e.actionspf2e.Item.eReSHVEPCsdkSL4G',\r\n    'learn-spell': 'Compendium.pf2e.actionspf2e.Item.Q5iIYCFdqJFM31GW',\r\n    climb: 'Compendium.pf2e.actionspf2e.Item.pprgrYQ1QnIDGZiy',\r\n    forceOpen: 'Compendium.pf2e.actionspf2e.Item.SjmKHgI7a5Z9JzBx',\r\n    grapple: 'Compendium.pf2e.actionspf2e.Item.PMbdMWc2QroouFGD',\r\n    highJump: 'Compendium.pf2e.actionspf2e.Item.2HJ4yuEFY1Cast4h',\r\n    longJump: 'Compendium.pf2e.actionspf2e.Item.JUvAvruz7yRQXfz2',\r\n    reposition: 'Compendium.pf2e.actionspf2e.Item.lOE4yjUnETTdaf2T',\r\n    shove: 'Compendium.pf2e.actionspf2e.Item.7blmbDrQFNfdT731',\r\n    swim: 'Compendium.pf2e.actionspf2e.Item.c8TGiZ48ygoSPofx',\r\n    trip: 'Compendium.pf2e.actionspf2e.Item.ge56Lu1xXVFYUnLP',\r\n    disarm: 'Compendium.pf2e.actionspf2e.Item.Dt6B1slsBy8ipJu9',\r\n    repair: 'Compendium.pf2e.actionspf2e.Item.bT3skovyLUtP22ME',\r\n    craft: 'Compendium.pf2e.actionspf2e.Item.rmwa3OyhTZ2i2AHl',\r\n    'crafting-goods': '',\r\n    earnIncome: 'Compendium.pf2e.actionspf2e.Item.QyzlsLrqM0EEwd7j',\r\n    'identify-alchemy': 'Compendium.pf2e.actionspf2e.Item.Q4kdWVOf2ztIBFg1',\r\n    createADiversion: 'Compendium.pf2e.actionspf2e.Item.GkmbTGfg8KcgynOA',\r\n    impersonate: 'Compendium.pf2e.actionspf2e.Item.AJstokjdG6iDjVjE',\r\n    lie: 'Compendium.pf2e.actionspf2e.Item.ewwCglB7XOPLUz72',\r\n    feint: 'Compendium.pf2e.actionspf2e.Item.QNAVeNKtHA0EUw4X',\r\n    bonMot: BON_MOT_UUID,\r\n    gatherInformation: 'Compendium.pf2e.actionspf2e.Item.plBGdZhqq5JBl1D8',\r\n    makeAnImpression: 'Compendium.pf2e.actionspf2e.Item.OX4fy22hQgUHDr0q',\r\n    request: 'Compendium.pf2e.actionspf2e.Item.DCb62iCBrJXy0Ik6',\r\n    coerce: 'Compendium.pf2e.actionspf2e.Item.tHCqgwjtQtzNqVvd',\r\n    demoralize: 'Compendium.pf2e.actionspf2e.Item.2u915NdUyQan6uKF',\r\n    'administer-first-aid': 'Compendium.pf2e.actionspf2e.Item.MHLuKy4nQO2Z4Am1',\r\n    'treat-disease': 'Compendium.pf2e.actionspf2e.Item.TC7OcDa7JlWbqMaN',\r\n    'treat-poison': 'Compendium.pf2e.actionspf2e.Item.KjoCEEmPGTeFE4hh',\r\n    treatWounds: 'Compendium.pf2e.actionspf2e.Item.1kGNdIIhuglAjIp9',\r\n    'command-an-animal': 'Compendium.pf2e.actionspf2e.Item.q9nbyIF0PEBqMtYe',\r\n    perform: 'Compendium.pf2e.actionspf2e.Item.EEDElIyin4z60PXx',\r\n    'staging-performance': '',\r\n    subsist: 'Compendium.pf2e.actionspf2e.Item.49y9Ec4bDii8pcD3',\r\n    'create-forgery': 'Compendium.pf2e.actionspf2e.Item.ftG89SjTSa9DYDOD',\r\n    'conceal-an-object': 'Compendium.pf2e.actionspf2e.Item.qVNVSmsgpKFGk9hV',\r\n    hide: 'Compendium.pf2e.actionspf2e.Item.XMcnh4cSI32tljXa',\r\n    sneak: 'Compendium.pf2e.actionspf2e.Item.VMozDqMMuK5kpoX4',\r\n    senseDirection: 'Compendium.pf2e.actionspf2e.Item.fJImDBQfqfjKJOhk',\r\n    'cover-tracks': 'Compendium.pf2e.actionspf2e.Item.SB7cMECVtE06kByk',\r\n    track: 'Compendium.pf2e.actionspf2e.Item.EA5vuSgJfiHH7plD',\r\n    'palm-an-object': 'Compendium.pf2e.actionspf2e.Item.ijZ0DDFpMkWqaShd',\r\n    steal: 'Compendium.pf2e.actionspf2e.Item.RDXXE7wMrSPCLv5k',\r\n    'disable-device': 'Compendium.pf2e.actionspf2e.Item.cYdz2grcOcRt4jk6',\r\n    'pick-a-lock': 'Compendium.pf2e.actionspf2e.Item.2EE4aF4SZpYf0R6H',\r\n}\r\n\r\nconst DUPLICATE_SKILLS = {\r\n    escape: { slug: 'escape', cost: '1', type: 2, noSkill: true },\r\n    'recall-knowledge': { slug: 'recall-knowledge', cost: '1', secret: true },\r\n    'decipher-writing': { slug: 'decipher-writing', type: 2, trained: true },\r\n    'identify-magic': { slug: 'identify-magic', trained: true },\r\n    'learn-spell': { slug: 'learn-spell', trained: true },\r\n}\r\n\r\nconst SKILLS = [\r\n    {\r\n        slug: 'perception',\r\n        actions: [\r\n            { slug: 'sense-motive', cost: '1', type: 2 },\r\n            { slug: 'seek', cost: '1', type: 2 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'acrobatics',\r\n        actions: [\r\n            { slug: 'balance', cost: '1', type: 2 },\r\n            // 'escape',\r\n            { slug: 'tumble-through', cost: '1', type: 2 },\r\n            { slug: 'maneuver-in-flight', cost: '1', type: 2, trained: true },\r\n            { slug: 'squeeze', type: 2, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'arcana',\r\n        actions: [\r\n            // 'recall-knowledge',\r\n            { slug: 'borrow-arcane-spell', trained: true },\r\n            'decipher-writing',\r\n            'identify-magic',\r\n            'learn-spell',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'athletics',\r\n        actions: [\r\n            { slug: 'climb', cost: '1', type: 1 },\r\n            // 'escape',\r\n            {\r\n                slug: 'forceOpen',\r\n                cost: '1',\r\n                type: 1,\r\n                map: true,\r\n                modifiers: [\r\n                    {\r\n                        condition: actor =>\r\n                            !actor.itemTypes.equipment.some(item => item.isHeld && CROWBAR_UUIDS.has(item.sourceId)),\r\n                        modifiers: [\r\n                            {\r\n                                slug: 'crowbar-missing',\r\n                                modifier: -2,\r\n                                type: 'circumstance',\r\n                            },\r\n                        ],\r\n                    },\r\n                ],\r\n            },\r\n            { slug: 'grapple', cost: '1', type: 1, map: true, agile: true },\r\n            { slug: 'highJump', cost: '1', type: 1 },\r\n            { slug: 'longJump', cost: '1', type: 1 },\r\n            { slug: 'reposition', cost: '1', type: 2, map: true, agile: true },\r\n            { slug: 'shove', cost: '1', type: 1, map: true, agile: true },\r\n            { slug: 'swim', cost: '1', type: 1 },\r\n            { slug: 'trip', cost: '1', type: 2, map: true, agile: true },\r\n            { slug: 'disarm', cost: '1', type: 1, map: true, trained: true, agile: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'crafting',\r\n        actions: [\r\n            // 'recall-knowledge',\r\n            { slug: 'repair', type: 1 },\r\n            { slug: 'craft', type: 1, trained: true },\r\n            { slug: 'crafting-goods', trained: true },\r\n            { slug: 'earnIncome', type: 3, trained: true },\r\n            { slug: 'identify-alchemy', trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'deception',\r\n        actions: [\r\n            { slug: 'createADiversion', cost: '1', type: 1, variants: ['distracting-words', 'gesture', 'trick'] },\r\n            { slug: 'impersonate', type: 1 },\r\n            { slug: 'lie', type: 1 },\r\n            { slug: 'feint', cost: '1', type: 1, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'diplomacy',\r\n        actions: [\r\n            {\r\n                slug: 'bonMot',\r\n                cost: '1',\r\n                type: 1,\r\n                condition: actor => hasFeat(actor, BON_MOT_UUID),\r\n            },\r\n            { slug: 'gatherInformation', type: 1 },\r\n            { slug: 'makeAnImpression', type: 1 },\r\n            { slug: 'request', cost: '1', type: 1 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'intimidation',\r\n        actions: [\r\n            { slug: 'coerce', type: 2 },\r\n            { slug: 'demoralize', cost: '1', type: 2 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'medicine',\r\n        actions: [\r\n            {\r\n                slug: 'administer-first-aid',\r\n                cost: '2',\r\n                type: 2,\r\n                variants: ['stabilize', 'stop-bleeding'],\r\n                rollOption: 'administer-first-aid',\r\n            },\r\n            { slug: 'treat-disease', type: 2, trained: true },\r\n            { slug: 'treat-poison', cost: '1', type: 2, trained: true },\r\n            { slug: 'treatWounds', type: 1, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'nature',\r\n        actions: [\r\n            { slug: 'command-an-animal', cost: '1', type: 2 }, //\r\n            // 'recall-knowledge',\r\n            'identify-magic',\r\n            'learn-spell',\r\n            { slug: 'treatWounds', type: 1, trained: true, condition: actor => hasFeat(actor, NATURAL_MEDICINE_UUID) },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'occultism',\r\n        actions: [\r\n            // 'recall-knowledge', //\r\n            'decipher-writing',\r\n            'identify-magic',\r\n            'learn-spell',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'performance',\r\n        actions: [\r\n            {\r\n                slug: 'perform',\r\n                cost: '1',\r\n                type: 1,\r\n                variants: ['acting', 'comedy', 'dance', 'keyboards', 'oratory', 'percussion', 'singing', 'strings', 'winds'],\r\n            },\r\n            { slug: 'staging-performance', trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'religion',\r\n        actions: [\r\n            // 'recall-knowledge', //\r\n            'decipher-writing',\r\n            'identify-magic',\r\n            'learn-spell',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'society',\r\n        actions: [\r\n            // 'recall-knowledge', //\r\n            { slug: 'subsist', type: 2 },\r\n            { slug: 'create-forgery', type: 2, trained: true },\r\n            'decipher-writing',\r\n        ],\r\n    },\r\n    {\r\n        slug: 'stealth',\r\n        actions: [\r\n            { slug: 'conceal-an-object', cost: '1', type: 2 },\r\n            { slug: 'hide', cost: '1', type: 2 },\r\n            { slug: 'sneak', cost: '1', type: 2 },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'survival',\r\n        actions: [\r\n            { slug: 'senseDirection', type: 1 },\r\n            { slug: 'subsist', type: 2 },\r\n            { slug: 'cover-tracks', trained: true },\r\n            { slug: 'track', type: 1, trained: true },\r\n        ],\r\n    },\r\n    {\r\n        slug: 'thievery',\r\n        actions: [\r\n            { slug: 'palm-an-object', cost: '1', type: 2 },\r\n            { slug: 'steal', cost: '1', type: 2 },\r\n            { slug: 'disable-device', cost: '2', type: 2, trained: true },\r\n            { slug: 'pick-a-lock', cost: '2', type: 2, trained: true },\r\n        ],\r\n    },\r\n]\r\n\r\nSKILLS.forEach(skill => {\r\n    skill.actions = skill.actions.map(action => (typeof action === 'string' ? DUPLICATE_SKILLS[action] : action))\r\n\r\n    const { slug, actions } = skill\r\n    for (let action of actions) {\r\n        const unslugged = action.slug.replace(/-(.)/g, (_, c) => c.toUpperCase()).capitalize()\r\n\r\n        action.skillSlug = slug\r\n        action.uuid = ACTIONS_UUIDS[action.slug]\r\n        action.label = LABELS[action.slug] ?? `PF2E.Actions.${unslugged}.Title`\r\n\r\n        if (action.variants) {\r\n            action.variants = action.variants.map(variant => ({\r\n                slug: variant,\r\n                label: `${MODULE_ID}.skills.actions.${variant}`,\r\n            }))\r\n        } else if (action.map) {\r\n            action.variants = [\r\n                { label: 'PF2E.Roll.Normal' },\r\n                { label: 'PF2E.MAPAbbreviationLabel', map: action.agile ? -4 : -5 },\r\n                { label: 'PF2E.MAPAbbreviationLabel', map: action.agile ? -8 : -10 },\r\n            ]\r\n        }\r\n\r\n        action.modifiers?.forEach(({ modifiers }) => {\r\n            modifiers.forEach(modifier => {\r\n                modifier.label = `${MODULE_ID}.skills.modifiers.${modifier.slug}`\r\n            })\r\n        })\r\n    }\r\n})\r\n\r\nexport const SKILLS_SLUGS = SKILLS.map(skill => skill.slug)\r\n\r\nconst SKILLS_MAP = SKILLS.reduce((skills, { slug, actions }) => {\r\n    skills[slug] = {\r\n        slug,\r\n        actions: actions.reduce((actions, action) => {\r\n            actions[action.slug] = action\r\n            return actions\r\n        }, {}),\r\n    }\r\n    return skills\r\n}, {})\r\n\r\nexport const skillActionsUUIDS = new Set(Object.values(ACTIONS_UUIDS).filter(Boolean))\r\n\r\nexport function getSkillLabel(slug) {\r\n    return game.i18n.localize(slug === 'perception' ? 'PF2E.PerceptionLabel' : CONFIG.PF2E.skillList[slug])\r\n}\r\n\r\nexport async function getSkillsData({ actor, filter }) {\r\n    const skills = []\r\n    const isCharacter = actor.isOfType('character')\r\n\r\n    const noUntrained =\r\n        isCharacter && getSetting('untrained') && !actor.itemTypes.feat.some(feat => feat.sourceId === UNTRAINED_IMPROVISATION)\r\n\r\n    for (let i = 0; i < SKILLS.length; i++) {\r\n        const { slug, actions } = SKILLS[i]\r\n        const { label, rank, mod } = actor.getStatistic(slug)\r\n\r\n        const name = game.i18n.localize(label)\r\n        const actionsList = actions\r\n            .filter(\r\n                ({ condition, trained }) =>\r\n                    (!noUntrained || !isCharacter || !trained || actor.skills[slug].rank >= 1) && (!condition || condition(actor))\r\n            )\r\n            .map(action => ({\r\n                ...action,\r\n                name: game.i18n.localize(action.label),\r\n                variants: action.variants?.map(variant => ({\r\n                    ...variant,\r\n                    name: game.i18n.localize(variant.label),\r\n                })),\r\n            }))\r\n\r\n        const passedFilter = filterIn(name, filter)\r\n        let filteredActions = actionsList\r\n        if (!passedFilter) {\r\n            filteredActions = actionsList.filter(\r\n                ({ name, variants }) => filterIn(name, filter) || variants?.some(variant => filterIn(variant.name, filter))\r\n            )\r\n            if (!filteredActions.length) continue\r\n        }\r\n\r\n        skills[i] = {\r\n            slug,\r\n            name,\r\n            rank,\r\n            modifier: modifier(mod),\r\n            actions: passedFilter ? actionsList : filteredActions,\r\n        }\r\n    }\r\n\r\n    skills.sort((a, b) => (a.slug === 'perception' ? -1 : b.slug === 'perception' ? 1 : localeCompare(a.name, b.name)))\r\n\r\n    const lores = Object.values(actor.skills)\r\n        .filter(({ lore, label }) => lore && filterIn(label, filter))\r\n        .map(({ label, rank, mod, slug }) => ({\r\n            slug,\r\n            label,\r\n            rank,\r\n            modifier: modifier(mod),\r\n        }))\r\n\r\n    const loresModifierWidth = lores.reduce((width, lore) => (lore.modifier.length > width ? lore.modifier.length : width), 2)\r\n\r\n    return {\r\n        contentData: {\r\n            follow: localize(`skills.actions.${isFollowingAnExpert(actor) ? 'following' : 'follow'}`),\r\n            skills,\r\n            lores,\r\n            loresModifierWidth,\r\n        },\r\n        doubled: getSetting('skills-columns'),\r\n    }\r\n}\r\n\r\nexport function addSkillsListeners({ el, actor, token, hud }) {\r\n    el.find('[data-action=action-description]').on('click', event => {\r\n        event.preventDefault()\r\n        const action = $(event.currentTarget).closest('.action')\r\n        showItemSummary(action, actor, action.find('.name').children().html())\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    el.find('[data-action=follow-the-expert]').on('click', async event => {\r\n        event.preventDefault()\r\n\r\n        const following = isFollowingAnExpert(actor)\r\n        if (following) return await following.delete()\r\n\r\n        const source = (await fromUuid(FOLLOW_THE_EXPERT_UUID)).toObject()\r\n        setProperty(source, 'flags.core.sourceId', FOLLOW_THE_EXPERT_UUID)\r\n        await actor.createEmbeddedDocuments('Item', [source])\r\n    })\r\n\r\n    el.find('[data-action=roll-skill]').on('click', event => {\r\n        event.preventDefault()\r\n        const { slug } = event.currentTarget.dataset\r\n        actor.getStatistic(slug)?.roll({ event })\r\n        if (getSetting('skill-close')) hud.close()\r\n    })\r\n\r\n    el.find('[data-action=roll-action]').on('click contextmenu', async event => {\r\n        event.preventDefault()\r\n        const target = $(event.currentTarget)\r\n        const { skillSlug, slug } = target.closest('.action').data()\r\n        const { variant, map } = target.data()\r\n        const variants = event.type === 'contextmenu' ? await variantsDialog(skillSlug) : undefined\r\n        if (variants !== null) {\r\n            rollAction({ event, actor, token, skillSlug, slug, variant, map, skill: variants?.selected })\r\n            if (getSetting('skill-close')) hud.close()\r\n        }\r\n    })\r\n\r\n    el.find('[data-action=action-chat]').on('click', async event => {\r\n        event.preventDefault()\r\n\r\n        const { uuid } = event.currentTarget.closest('.action').dataset\r\n        const item = await fromUuid(uuid)\r\n        if (!item) return\r\n\r\n        unownedItemToMessage(event, item, actor, { create: true })\r\n        if (getSetting('chat-close')) hud.close()\r\n    })\r\n}\r\n\r\nfunction isFollowingAnExpert(actor) {\r\n    return actor.itemTypes.effect.find(effect => effect.sourceId === FOLLOW_THE_EXPERT_UUID)\r\n}\r\n\r\nexport async function variantsDialog(base, dc) {\r\n    const skills = SKILLS_SLUGS.map(slug => ({ slug, label: getSkillLabel(slug) }))\r\n\r\n    const content = await renderTemplate(templatePath('dialogs/variant'), {\r\n        i18n: str => localize(`skills.variant.${str}`),\r\n        dc,\r\n        skills,\r\n        selected: base,\r\n    })\r\n\r\n    return Dialog.prompt({\r\n        title: localize('skills.variant.title'),\r\n        label: localize('skills.variant.button'),\r\n        callback: html => ({ selected: html.find('select').val(), dc: Number(html.find('input').val()) }),\r\n        rejectClose: false,\r\n        content,\r\n        options: { width: 280 },\r\n    })\r\n}\r\n\r\nfunction rollAction({ event, actor, skillSlug, slug, variant, map, skill, token }) {\r\n    const action = SKILLS_MAP[skillSlug].actions[slug]\r\n    const type = action.type === 3 ? 3 : game.pf2e.actions.has(slug) ? 2 : 1\r\n\r\n    skill ??= action.noSkill ? undefined : skillSlug\r\n\r\n    const rollOptions = action.rollOption ? [`action:${action.rollOption}`] : undefined\r\n    if (rollOptions && variant) rollOptions.push(`action:${action.rollOption}:${variant}`)\r\n\r\n    const options = {\r\n        event,\r\n        actors: [actor],\r\n        tokens: [token],\r\n        variant,\r\n        rollOptions,\r\n        rollMode: action.secret ? 'blindroll' : 'roll',\r\n    }\r\n\r\n    options.modifiers = []\r\n\r\n    if (action.modifiers) {\r\n        for (const { condition, modifiers } of action.modifiers) {\r\n            if (condition && !condition(actor)) continue\r\n            for (const modifier of modifiers) {\r\n                options.modifiers.push(new game.pf2e.Modifier(modifier))\r\n            }\r\n        }\r\n    }\r\n\r\n    if (action.custom) {\r\n        action.custom(actor, options)\r\n        return\r\n    } else if (!type) {\r\n        actor.getStatistic(skill)?.roll(options)\r\n        return\r\n    }\r\n\r\n    // old actions\r\n    if (type === 1) {\r\n        options.skill = skill\r\n        if (map) options.modifiers.push(new game.pf2e.Modifier({ label: 'PF2E.MultipleAttackPenalty', modifier: map }))\r\n        game.pf2e.actions[slug](options)\r\n    }\r\n    // new actions\r\n    else if (type === 2) {\r\n        options.statistic = skill\r\n        if (map) options.multipleAttackPenalty = map / -5\r\n        game.pf2e.actions.get(slug).use(options)\r\n    }\r\n    // exception for old actions that only accept one actor argument\r\n    else if (type === 3) {\r\n        game.pf2e.actions[slug](actor)\r\n    }\r\n}\r\n", "import { rollRecallKnowledges } from '../actions/recall-knowledge.js'\r\nimport { getSetting, localize } from '../module.js'\r\nimport { unownedItemToMessage } from '../pf2e/item.js'\r\nimport { showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, deleteMacro, filterIn, getMacros, onDroppedMacro } from '../shared.js'\r\nimport { variantsDialog, getSkillLabel, SKILLS_SLUGS } from './skills.js'\r\n\r\nexport const extrasUUIDS = {\r\n    aid: 'Compendium.pf2e.actionspf2e.Item.HCl3pzVefiv9ZKQW',\r\n    escape: 'Compendium.pf2e.actionspf2e.Item.SkZAQRkLLkmBQNB9',\r\n    'recall-knowledge': 'Compendium.pf2e.actionspf2e.Item.1OagaWtBpVXExToo',\r\n    'point-out': 'Compendium.pf2e.actionspf2e.Item.sn2hIy1iIJX9Vpgj',\r\n}\r\n\r\nexport async function getExtrasData({ actor, filter }) {\r\n    const { attributes } = actor\r\n    const { initiative } = attributes\r\n\r\n    return {\r\n        contentData: {\r\n            noMacro: localize('extras.no-macro'),\r\n            macros: getMacros(actor)?.filter(macro => filterIn(macro.name, filter)),\r\n            initiative: initiative && {\r\n                selected: initiative.statistic,\r\n                skills: SKILLS_SLUGS.map(slug => ({ slug, label: getSkillLabel(slug) })),\r\n            },\r\n            hasDailies: game.modules.get('pf2e-dailies')?.active,\r\n            hasPerception: game.modules.get('pf2e-perception')?.active,\r\n            uuids: extrasUUIDS,\r\n        },\r\n    }\r\n}\r\n\r\nexport function addExtrasListeners({ el, actor, token, hud }) {\r\n    function action(action, callback, type = 'click') {\r\n        el.find(`[data-action=${action}]`).on(type, event => {\r\n            event.preventDefault()\r\n            callback(event)\r\n        })\r\n    }\r\n\r\n    action('action-description', event => {\r\n        const action = $(event.currentTarget).closest('.row')\r\n        showItemSummary(action, actor)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    addNameTooltipListeners(el.find('.macro'))\r\n\r\n    async function getMacro(event) {\r\n        const { uuid } = event.currentTarget.closest('.macro').dataset\r\n        return fromUuid(uuid)\r\n    }\r\n\r\n    action('delete-macro', event => deleteMacro(event, actor))\r\n\r\n    action('edit-macro', async event => {\r\n        const macro = await getMacro(event)\r\n        macro?.sheet.render(true)\r\n    })\r\n\r\n    action('use-macro', async event => {\r\n        const macro = await getMacro(event)\r\n        macro?.execute({ actor, token })\r\n        if (getSetting('macro-close')) hud.close()\r\n    })\r\n\r\n    el.on('drop', event => onDroppedMacro(event, actor))\r\n\r\n    action('action-chat', async event => {\r\n        const { uuid } = event.currentTarget.closest('.row').dataset\r\n        const item = await fromUuid(uuid)\r\n        if (!item) return\r\n\r\n        unownedItemToMessage(event, item, actor, { create: true })\r\n        if (getSetting('chat-close')) hud.close()\r\n    })\r\n\r\n    el.find('input[name], select[name]').on('change', async event => {\r\n        const target = event.currentTarget\r\n        const value = target.type === 'number' ? target.valueAsNumber : target.value\r\n        await actor.update({ [target.name]: value })\r\n    })\r\n\r\n    action('roll-initiative', async event => {\r\n        await actor.initiative.roll({ event })\r\n        if (getSetting('skill-close')) hud.close()\r\n    })\r\n\r\n    action('prepare-dailies', event => {\r\n        const dailies = game.modules.get('pf2e-dailies')\r\n        if (dailies?.active) dailies.api.openDailiesInterface(actor)\r\n    })\r\n\r\n    action('rest-for-the-night', event => {\r\n        game.pf2e.actions.restForTheNight({ actors: [actor], tokens: [token] })\r\n    })\r\n\r\n    action('roll-recall-knowledge', event => {\r\n        rollRecallKnowledges(actor)\r\n        if (getSetting('skill-close')) hud.close()\r\n    })\r\n\r\n    action(\r\n        'roll-aid',\r\n        async event => {\r\n            const variants = await variantsDialog(null, 15)\r\n            const note = { text: '@UUID[Compendium.pf2e.other-effects.Item.AHMUpMbaVkZ5A1KX]' }\r\n            if (variants !== null) {\r\n                game.pf2e.actions.get('aid').use({\r\n                    event,\r\n                    actors: [actor],\r\n                    tokens: [token],\r\n                    statistic: variants?.selected,\r\n                    difficultyClass: { value: variants?.dc },\r\n                    notes: [note],\r\n                })\r\n                if (getSetting('skill-close')) hud.close()\r\n            }\r\n        },\r\n        'click contextmenu'\r\n    )\r\n\r\n    action('roll-point-out', event => {\r\n        game.pf2e.actions.get('point-out').use({ event, actors: [actor], tokens: [token] })\r\n        if (getSetting('skill-close')) hud.close()\r\n    })\r\n\r\n    action(\r\n        'roll-escape',\r\n        async event => {\r\n            const variants = event.type === 'contextmenu' ? await variantsDialog() : undefined\r\n            const multipleAttackPenalty = $(event.currentTarget).data().map\r\n            if (variants === null) return\r\n\r\n            game.pf2e.actions\r\n                .get('escape')\r\n                .use({ event, actors: [actor], tokens: [token], statistic: variants?.selected, multipleAttackPenalty })\r\n\r\n            if (getSetting('skill-close')) hud.close()\r\n        },\r\n        'click contextmenu'\r\n    )\r\n}\r\n", "import { enrichHTML, getSetting, localize, templatePath } from '../module.js'\r\nimport { createSelfEffectMessage } from '../pf2e/item.js'\r\nimport { getActionIcon } from '../pf2e/misc.js'\r\nimport { toggleWeaponTrait } from '../pf2e/weapon.js'\r\nimport { popup, showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, filterIn, getItemFromEvent, localeCompare } from '../shared.js'\r\nimport { extrasUUIDS } from './extras.js'\r\nimport { skillActionsUUIDS } from './skills.js'\r\n\r\nconst SECTIONS_TYPES = {\r\n    action: { order: 0, label: 'PF2E.ActionsActionsHeader', actionLabel: 'PF2E.ActionTypeAction' },\r\n    reaction: { order: 1, label: 'PF2E.ActionsReactionsHeader', actionLabel: 'PF2E.ActionTypeReaction' },\r\n    free: { order: 2, label: 'PF2E.ActionsFreeActionsHeader', actionLabel: 'PF2E.ActionTypeFree' },\r\n    passive: { order: 3, label: 'PF2E.NPC.PassivesLabel', actionLabel: 'PF2E.ActionTypePassive' },\r\n    exploration: { order: 3, label: 'PF2E.TravelSpeed.ExplorationActivity', actionLabel: 'PF2E.TabActionsExplorationLabel' },\r\n}\r\n\r\nexport async function getActionsData({ hud, actor, filter }) {\r\n    const isCharacter = actor.isOfType('character')\r\n    const toggles = actor.synthetics.toggles.slice()\r\n    const sorting = getSetting('actions')\r\n\r\n    const stances = (await getStancesModuleApi()?.getStances(actor))?.sort((a, b) => localeCompare(a.name, b.name))\r\n\r\n    const heroActions = isCharacter ? await getHeroActionsApi()?.getHeroActions(actor) : undefined\r\n    const heroDiff = heroActions ? actor.heroPoints.value - heroActions.length : undefined\r\n\r\n    const isOwner = actor.isOwner\r\n    const rollData = actor.getRollData()\r\n\r\n    const strikes = actor.system.actions\r\n        ? await Promise.all(\r\n              actor.system.actions.map(async (strike, index) => ({\r\n                  ...strike,\r\n                  index,\r\n                  visible: !isCharacter || strike.visible,\r\n                  damageFormula: await strike.damage?.({ getFormula: true }),\r\n                  criticalFormula: await strike.critical?.({ getFormula: true }),\r\n                  description: strike.description\r\n                      ? await enrichHTML(strike.description, actor, { rollData, isOwner })\r\n                      : undefined,\r\n                  altUsages:\r\n                      strike.altUsages &&\r\n                      (await Promise.all(\r\n                          strike.altUsages.map(async altUsage => ({\r\n                              ...altUsage,\r\n                              usage: altUsage.item.isThrown ? 'thrown' : 'melee',\r\n                              damageFormula: await altUsage.damage?.({ getFormula: true }),\r\n                              criticalFormula: await altUsage.critical?.({ getFormula: true }),\r\n                          }))\r\n                      )),\r\n              }))\r\n          )\r\n        : undefined\r\n\r\n    const blast = isCharacter ? new game.pf2e.ElementalBlast(actor) : undefined\r\n    const blasts = blast\r\n        ? (\r\n              await Promise.all(\r\n                  blast.configs.map(async config => {\r\n                      const damageType = config.damageTypes.find(damage => damage.selected)?.value ?? 'untyped'\r\n\r\n                      const formulaFor = (outcome, melee = true) => {\r\n                          return blast.damage({\r\n                              element: config.element,\r\n                              damageType,\r\n                              melee,\r\n                              outcome,\r\n                              getFormula: true,\r\n                          })\r\n                      }\r\n\r\n                      return {\r\n                          ...config,\r\n                          damageType,\r\n                          formula: {\r\n                              melee: {\r\n                                  damage: await formulaFor('success'),\r\n                                  critical: await formulaFor('criticalSuccess'),\r\n                              },\r\n                              ranged: {\r\n                                  damage: await formulaFor('success', false),\r\n                                  critical: await formulaFor('criticalSuccess', false),\r\n                              },\r\n                          },\r\n                      }\r\n                  })\r\n              )\r\n          ).sort((a, b) => localeCompare(a.label, b.label))\r\n        : undefined\r\n\r\n    let sections = {}\r\n\r\n    const actions = isCharacter ? getCharacterActions(actor, stances) : getNpcActions(actor)\r\n    for (const action of actions) {\r\n        if (!filterIn(action.name, filter)) continue\r\n\r\n        if (sorting !== 'split') {\r\n            sections.action ??= []\r\n            sections.action.push(action)\r\n        } else {\r\n            sections[action.type] ??= []\r\n            sections[action.type].push(action)\r\n        }\r\n    }\r\n\r\n    sections = Object.entries(sections).map(([type, actions]) => {\r\n        actions.forEach(action => {\r\n            action.img = getActionIcon(action.cost)\r\n            action.typeLabel = SECTIONS_TYPES[action.type].actionLabel\r\n        })\r\n\r\n        if (sorting !== 'type') {\r\n            actions.sort((a, b) => localeCompare(a.name, b.name))\r\n        } else {\r\n            actions.sort((a, b) => {\r\n                const orderA = SECTIONS_TYPES[a.type].order\r\n                const orderB = SECTIONS_TYPES[b.type].order\r\n                return orderA === orderB ? localeCompare(a.name, b.name) : orderA - orderB\r\n            })\r\n        }\r\n\r\n        return { type, actions, label: SECTIONS_TYPES[type].label }\r\n    })\r\n\r\n    if (sorting === 'split') sections.sort((a, b) => SECTIONS_TYPES[a.type].order - SECTIONS_TYPES[b.type].order)\r\n\r\n    if (toggles.length || stances?.length || strikes?.length || blasts?.length || sections.length || heroActions?.length) {\r\n        const nb =\r\n            Number((stances?.length ?? 0) > 0) +\r\n            Number((strikes?.length ?? 0) > 0) +\r\n            Number((blasts?.length ?? 0) > 0) +\r\n            sections.length +\r\n            Number((heroActions?.length ?? 0) > 0)\r\n\r\n        return {\r\n            contentData: {\r\n                toggles,\r\n                stances,\r\n                strikes,\r\n                blasts,\r\n                sections,\r\n                heroActions: heroActions && {\r\n                    actions: heroActions,\r\n                    draw: Math.max(heroDiff, 0),\r\n                    discard: Math.abs(Math.min(heroDiff, 0)),\r\n                    canTrade: heroActions.length && canTradeHeroActions(),\r\n                },\r\n                i18n: str => localize(`actions.${str}`),\r\n                variantLabel: label => label.replace(/.+\\((.+)\\)/, '$1'),\r\n                damageTypes: CONFIG.PF2E.damageTypes,\r\n            },\r\n            doubled: nb > 1 && getSetting('actions-columns'),\r\n            classes: [getSetting('actions-colors') ? 'attack-damage-system-colors' : ''],\r\n        }\r\n    }\r\n}\r\n\r\nexport function addActionsListeners({ el, actor, hud }) {\r\n    addNameTooltipListeners(el.find('.toggle'))\r\n    addNameTooltipListeners(el.find('.strike'))\r\n    addNameTooltipListeners(el.find('.action'))\r\n\r\n    function action(action, callback, type = 'click') {\r\n        action = typeof action === 'string' ? [action] : action\r\n        action = action.map(x => `[data-action=${x}]`).join(', ')\r\n        return el.find(action).on(type, event => {\r\n            event.preventDefault()\r\n            callback(event)\r\n        })\r\n    }\r\n\r\n    function getStrike(event) {\r\n        const strikeEl = event.currentTarget.closest('.strike')\r\n        const strike = actor.system.actions[strikeEl.dataset.index]\r\n        if (!strike) return null\r\n\r\n        const { altUsage } = event.currentTarget.dataset\r\n        return ['melee', 'thrown'].includes(altUsage)\r\n            ? strike.altUsages?.find(s => (altUsage === 'thrown' ? s.item.isThrown : s.item.isMelee)) ?? null\r\n            : strike\r\n    }\r\n\r\n    function getUuid(event) {\r\n        return $(event.currentTarget).closest('.action').data().uuid\r\n    }\r\n\r\n    action('action-description', async event => {\r\n        const action = $(event.currentTarget).closest('.action')\r\n        showItemSummary(action, actor)\r\n    })\r\n\r\n    action('hero-action-description', async event => {\r\n        const uuid = getUuid(event)\r\n        const { description, name } = (await getHeroActionsApi()?.getHeroActionDetails(uuid)) ?? {}\r\n        if (description) popup(name, description, actor)\r\n    })\r\n\r\n    action('strike-description', async event => {\r\n        const strike = getStrike(event)\r\n        if (!strike) return\r\n\r\n        const description = document.createElement('div')\r\n        description.classList.add('description')\r\n        // this one is a copy of the system template, there is nothing to generate it\r\n        description.innerHTML = await renderTemplate(templatePath('strike-description'), strike)\r\n\r\n        popup(strike.label, description, actor)\r\n    })\r\n\r\n    action('blast-description', async event => {\r\n        const blast = event.currentTarget.closest('.blast')\r\n        showItemSummary($(blast), actor)\r\n    })\r\n\r\n    action('trait-description', event => {\r\n        const strike = getStrike(event)\r\n        if (!strike) return\r\n\r\n        const { index } = event.currentTarget.dataset\r\n        const trait = strike.traits[index]\r\n        if (!trait) return\r\n\r\n        const description = game.i18n.localize(trait.description)\r\n        if (description) popup(game.i18n.localize(trait.label), description, actor)\r\n    })\r\n\r\n    action('stance-description', event => {\r\n        const stance = $(event.currentTarget).closest('.action')\r\n        showItemSummary(stance, actor, stance.data().itemName)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    action('use-action', event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        if (item?.isOfType('action', 'feat')) {\r\n            createSelfEffectMessage(item)\r\n            if (getSetting('action-effect')) applyActionEffect(actor, item)\r\n            if (getSetting('action-close')) hud.close()\r\n        }\r\n    })\r\n\r\n    action('stance-chat', event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n\r\n        item.toMessage(event, { create: true })\r\n        if (getSetting('chat-close')) hud.close()\r\n    })\r\n\r\n    action('stance-toggle', event => {\r\n        const { effectUuid } = event.currentTarget.closest('.action').dataset\r\n        getStancesModuleApi()?.toggleStance(actor, effectUuid)\r\n    })\r\n\r\n    action('exploration-toggle', event => {\r\n        const actionId = event.currentTarget.closest('.action').dataset.itemId\r\n\r\n        const exploration = actor.system.exploration.filter(id => actor.items.has(id))\r\n        if (!exploration.findSplice(id => id === actionId)) {\r\n            exploration.push(actionId)\r\n        }\r\n\r\n        actor.update({ 'system.exploration': exploration })\r\n    })\r\n\r\n    action('action-chat', event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n\r\n        item.toMessage(event, { create: true })\r\n        if (getSetting('chat-close')) hud.close()\r\n    })\r\n\r\n    action('hero-action-chat', async event => {\r\n        const api = getHeroActionsApi()\r\n        if (!api) return\r\n\r\n        api.sendActionToChat(actor, getUuid(event))\r\n        if (getSetting('chat-close')) hud.close()\r\n    })\r\n\r\n    action('draw-hero-action', async event => {\r\n        await getHeroActionsApi()?.drawHeroActions(actor)\r\n    })\r\n\r\n    action('use-hero-action', async event => {\r\n        const api = getHeroActionsApi()\r\n        if (!api) return\r\n\r\n        api.useHeroAction(actor, getUuid(event))\r\n        if (getSetting('action-close')) hud.close()\r\n    })\r\n\r\n    action('discard-hero-action', async event => {\r\n        await getHeroActionsApi()?.discardHeroActions(actor, getUuid(event))\r\n    })\r\n\r\n    action('trade-hero-action', async event => {\r\n        getHeroActionsApi()?.tradeHeroAction(actor)\r\n    })\r\n\r\n    action('strike-attack', event => {\r\n        const { index, altUsage } = event.currentTarget.dataset\r\n        const strike = getStrike(event)\r\n\r\n        strike?.variants[index].roll({ event, altUsage })\r\n        if (getSetting('attack-close')) hud.close()\r\n    })\r\n\r\n    action(['strike-damage', 'strike-critical'], event => {\r\n        const { action } = event.currentTarget.dataset\r\n        const strike = getStrike(event)\r\n\r\n        strike?.[action === 'strike-damage' ? 'damage' : 'critical']({ event })\r\n        if (getSetting('attack-close')) hud.close()\r\n    })\r\n\r\n    action(['toggle-roll-option', 'set-suboption'], event => {\r\n        const toggle = event.currentTarget.closest('.toggle')\r\n        const { domain, option, itemId } = toggle.dataset\r\n        const suboption = toggle.querySelector('select')?.value ?? null\r\n        actor.toggleRollOption(domain, option, itemId ?? null, toggle.querySelector('input').checked, suboption)\r\n    })\r\n\r\n    action('strike-auxiliary', event => {\r\n        if (event.currentTarget !== event.target) return\r\n\r\n        const strike = getStrike(event)\r\n        if (!strike) return\r\n\r\n        const { index } = event.currentTarget.dataset\r\n        const modular = event.currentTarget.querySelector('select')?.value ?? null\r\n\r\n        strike.auxiliaryActions?.[index]?.execute({ selection: modular })\r\n    })\r\n\r\n    action('toggle-versatile', event => {\r\n        const weapon = getStrike(event)?.item\r\n        if (!weapon) return\r\n\r\n        const target = event.currentTarget\r\n        const { value } = target.dataset\r\n        const baseType = weapon?.system.damage.damageType ?? null\r\n        const selection = target.classList.contains('selected') || value === baseType ? null : value\r\n\r\n        toggleWeaponTrait({ trait: 'versatile', weapon, selection })\r\n    })\r\n\r\n    action(\r\n        'strike-ammo',\r\n        async event => {\r\n            const weapon = getStrike(event)?.item\r\n            if (!weapon) return\r\n\r\n            const ammo = actor.items.get(event.currentTarget.value)\r\n            await weapon.update({ system: { selectedAmmoId: ammo?.id ?? null } })\r\n        },\r\n        'change'\r\n    )\r\n\r\n    if (!actor.isOfType('character')) return\r\n\r\n    const selectors = ['roll-attack', 'roll-damage', 'set-damage-type'].map(s => `[data-action=${s}]`).join(',')\r\n    el.find('.blast').each((_, blastEl) => {\r\n        const { element, damageType } = blastEl.dataset\r\n        const blast = new game.pf2e.ElementalBlast(actor)\r\n\r\n        $(blastEl)\r\n            .find(selectors)\r\n            .on('click', async event => {\r\n                event.preventDefault()\r\n\r\n                const dataset = event.currentTarget.dataset\r\n                const melee = dataset.melee === 'true'\r\n\r\n                switch (dataset.action) {\r\n                    case 'roll-attack': {\r\n                        const mapIncreases = Math.clamped(Number(dataset.mapIncreases), 0, 2)\r\n                        blast.attack({ mapIncreases: Math.clamped(mapIncreases, 0, 2), element, damageType, melee, event })\r\n                        break\r\n                    }\r\n                    case 'roll-damage': {\r\n                        blast.damage({ element, damageType, melee, outcome: dataset.outcome, event })\r\n                        break\r\n                    }\r\n                    case 'set-damage-type': {\r\n                        blast.setDamageType({ element, damageType: dataset.value })\r\n                    }\r\n                }\r\n\r\n                if (['roll-attack', 'roll-damage'].includes(dataset.action) && getSetting('attack-close')) hud.close()\r\n            })\r\n    })\r\n}\r\n\r\nfunction getToolBeltModule(setting) {\r\n    const module = game.modules.get('pf2e-toolbelt')\r\n    return module?.active && game.settings.get('pf2e-toolbelt', setting) ? module : undefined\r\n}\r\n\r\nfunction getToolBeltApi(setting) {\r\n    return getToolBeltModule(setting)?.api\r\n}\r\n\r\nfunction getStancesModuleApi() {\r\n    const module = game.modules.get('pf2e-stances')\r\n    return module?.active ? module.api : getToolBeltApi('stances')?.stances\r\n}\r\n\r\nfunction getHeroActionsApi() {\r\n    const module = game.modules.get('pf2e-hero-actions')\r\n    return module?.active ? module.api : getToolBeltApi('hero')?.heroActions\r\n}\r\n\r\nfunction canTradeHeroActions() {\r\n    if (game.modules.get('pf2e-hero-actions')?.active) return game.settings.get('pf2e-hero-actions', 'trade')\r\n    if (getToolBeltModule('hero')) return game.settings.get('pf2e-toolbelt', 'hero-trade')\r\n}\r\n\r\nfunction getCharacterActions(actor, stances) {\r\n    const stancesUUIDS =\r\n        getStancesModuleApi()?.getActionsUUIDS?.() ??\r\n        (stances?.some(stance => stance.actionUUID) ? new Set(stances.map(({ actionUUID }) => actionUUID)) : undefined) ??\r\n        new Set()\r\n\r\n    const actionsUUIDS = new Set([...stancesUUIDS, ...skillActionsUUIDS, ...Object.values(extrasUUIDS)])\r\n    const actions = actor.itemTypes.action\r\n    const feats = actor.itemTypes.feat.filter(item => item.actionCost)\r\n    const inParty = actor.parties.size > 0\r\n    const explorations = actor.system.exploration\r\n\r\n    return [...actions, ...feats]\r\n        .map(action => {\r\n            const sourceId = action.sourceId\r\n            const actionId = action.id\r\n            const actionCost = action.actionCost\r\n            const traits = action.system.traits.value\r\n            const isExploration = traits.includes('exploration')\r\n\r\n            return {\r\n                sourceId,\r\n                id: actionId,\r\n                type: actionCost?.type ?? (isExploration ? 'exploration' : 'free'),\r\n                cost: actionCost,\r\n                name: action.name,\r\n                isExploration,\r\n                isDowntime: traits.includes('downtime'),\r\n                isActive: isExploration && explorations.includes(actionId),\r\n                hasEffect: !!action.system.selfEffect,\r\n            }\r\n        })\r\n        .filter(\r\n            action =>\r\n                !action.isDowntime &&\r\n                (inParty || !action.isExploration) &&\r\n                (action.isExploration || !actionsUUIDS.has(action.sourceId))\r\n        )\r\n}\r\n\r\nfunction getNpcActions(actor) {\r\n    return actor.itemTypes.action.map(item => {\r\n        const actionCost = item.actionCost\r\n        const actionType = actionCost?.type ?? 'passive'\r\n        const hasAura =\r\n            actionType === 'passive' &&\r\n            (item.system.traits.value.includes('aura') || !!item.system.rules.find(r => r.key === 'Aura'))\r\n\r\n        return {\r\n            id: item.id,\r\n            type: actionType,\r\n            cost: actionCost,\r\n            name: item.name,\r\n            hasDeathNote: item.system.deathNote,\r\n            hasAura,\r\n            hasEffect: !!item.system.selfEffect,\r\n        }\r\n    })\r\n}\r\n\r\nasync function applyActionEffect(actor, item) {\r\n    const uuid = item.system.selfEffect?.uuid\r\n    if (!uuid) return\r\n\r\n    const source = (await fromUuid(uuid))?.toObject()\r\n    if (!source) return\r\n\r\n    actor.createEmbeddedDocuments('Item', [source])\r\n}\r\n", "import { enrichHTML, getSetting, modifier } from '../module.js'\r\nimport { listenInlineRoll } from '../pf2e/inline-roll.js'\r\nimport { showItemSummary } from '../popup.js'\r\n\r\nexport async function getHazardData({ actor }) {\r\n    const { system } = actor\r\n    const { details, traits, attributes } = system\r\n    const { stealth } = attributes\r\n    const { description, disable, routine, reset, isComplex } = details\r\n    const rollData = actor.getRollData()\r\n    const isOwner = actor.isOwner\r\n\r\n    const enrich = async str => {\r\n        return enrichHTML(str, actor, { isOwner, rollData })\r\n    }\r\n\r\n    return {\r\n        contentData: {\r\n            description: await enrich(description),\r\n            disable: await enrich(disable),\r\n            routine: await enrich(routine),\r\n            reset: await enrich(reset),\r\n            isComplex,\r\n            rarity: { value: traits.rarity, label: CONFIG.PF2E.rarityTraits[traits.rarity] },\r\n            traits: traits.value.map(trait => CONFIG.PF2E.hazardTraits[trait]),\r\n            stealth: modifier(stealth.value),\r\n        },\r\n        style: { ['--max-width']: getSetting('hazard-width') + 'em' },\r\n    }\r\n}\r\n\r\nexport function addHazardListeners({ el, actor }) {\r\n    el.find('[data-action=action-description]').on('click', event => {\r\n        event.preventDefault()\r\n        const action = $(event.currentTarget).closest('.action')\r\n        showItemSummary(action, actor)\r\n    })\r\n\r\n    listenInlineRoll(el[0], actor)\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    el.find('[data-action=roll-initiative').on('click', event => {\r\n        event.preventDefault()\r\n        actor.initiative.roll({ event })\r\n    })\r\n}\r\n", "import { getChatMessageClass } from './classes.js'\r\nimport { adjustDCByRarity, calculateDC } from './dc.js'\r\nimport { setHasElement } from './misc.js'\r\n\r\nconst MAGIC_TRADITIONS = new Set(['arcane', 'divine', 'occult', 'primal'])\r\n\r\nfunction getDcRarity(item) {\r\n    return item.traits.has('cursed') ? 'unique' : item.rarity\r\n}\r\n\r\nfunction getMagicTraditions(item) {\r\n    const traits = item.system.traits.value\r\n    return new Set(traits.filter(t => setHasElement(MAGIC_TRADITIONS, t)))\r\n}\r\n\r\nfunction getIdentifyMagicDCs(item, baseDC, notMatchingTraditionModifier) {\r\n    const result = {\r\n        occult: baseDC,\r\n        primal: baseDC,\r\n        divine: baseDC,\r\n        arcane: baseDC,\r\n    }\r\n    const traditions = getMagicTraditions(item)\r\n    for (const key of MAGIC_TRADITIONS) {\r\n        if (traditions.size > 0 && !traditions.has(key)) {\r\n            result[key] = baseDC + notMatchingTraditionModifier\r\n        }\r\n    }\r\n    return { arcana: result.arcane, nature: result.primal, religion: result.divine, occultism: result.occult }\r\n}\r\n\r\nfunction getItemIdentificationDCs(item, { proficiencyWithoutLevel = false, notMatchingTraditionModifier }) {\r\n    const baseDC = calculateDC(item.level, { proficiencyWithoutLevel })\r\n    const rarity = getDcRarity(item)\r\n    const dc = adjustDCByRarity(baseDC, rarity)\r\n    if (item.isMagical) {\r\n        return getIdentifyMagicDCs(item, dc, notMatchingTraditionModifier)\r\n    } else if (item.isAlchemical) {\r\n        return { crafting: dc }\r\n    } else {\r\n        return { dc: dc }\r\n    }\r\n}\r\n\r\nfunction objectHasKey(obj, key) {\r\n    return (typeof key === 'string' || typeof key === 'number') && key in obj\r\n}\r\n\r\nexport class IdentifyItemPopup extends FormApplication {\r\n    static get defaultOptions() {\r\n        return {\r\n            ...super.defaultOptions,\r\n            id: 'identify-item',\r\n            title: game.i18n.localize('PF2E.identification.Identify'),\r\n            template: 'systems/pf2e/templates/actors/identify-item.hbs',\r\n            width: 'auto',\r\n            classes: ['identify-popup'],\r\n        }\r\n    }\r\n\r\n    get item() {\r\n        return this.object\r\n    }\r\n\r\n    async getData() {\r\n        const item = this.object\r\n        const notMatchingTraditionModifier = game.settings.get('pf2e', 'identifyMagicNotMatchingTraditionModifier')\r\n        const proficiencyWithoutLevel = game.settings.get('pf2e', 'proficiencyVariant') === 'ProficiencyWithoutLevel'\r\n        const dcs = getItemIdentificationDCs(item, { proficiencyWithoutLevel, notMatchingTraditionModifier })\r\n\r\n        return {\r\n            ...(await super.getData()),\r\n            isMagic: item.isMagical,\r\n            isAlchemical: item.isAlchemical,\r\n            dcs,\r\n        }\r\n    }\r\n\r\n    activateListeners($form) {\r\n        $form.find('button.update-identification').on('click', event => {\r\n            const $button = $(event.delegateTarget)\r\n            this.submit({ updateData: { status: $button.val() } })\r\n        })\r\n        $form.find('button.post-skill-checks').on('click', async () => {\r\n            const item = this.item\r\n            const itemImg = item.system.identification.unidentified.img\r\n            const itemName = item.system.identification.unidentified.name\r\n            const identifiedName = item.system.identification.identified.name\r\n            const skills = $('div#identify-item')\r\n                .find('tr')\r\n                .toArray()\r\n                .flatMap(row => {\r\n                    const slug = row.dataset.skill\r\n                    const dc = Number(row.dataset.dc)\r\n                    if (!(Number.isInteger(dc) && objectHasKey(CONFIG.PF2E.skillList, slug))) {\r\n                        return []\r\n                    }\r\n                    const name = game.i18n.localize(CONFIG.PF2E.skillList[slug])\r\n\r\n                    return { slug, name, dc }\r\n                })\r\n\r\n            const actionOption = item.isMagical ? 'action:identify-magic' : item.isAlchemical ? 'action:identify-alchemy' : null\r\n\r\n            const content = await renderTemplate('systems/pf2e/templates/actors/identify-item-chat-skill-checks.hbs', {\r\n                itemImg,\r\n                itemName,\r\n                identifiedName,\r\n                // We don't want to install remeda just for that so we do our own thing\r\n                // rollOptions: R.compact(['concentrate', 'exploration', 'secret', actionOption]),\r\n                rollOptions: ['concentrate', 'exploration', 'secret', actionOption].filter(Boolean),\r\n                skills,\r\n            })\r\n\r\n            await getChatMessageClass().create({ user: game.user.id, content })\r\n        })\r\n    }\r\n\r\n    async _updateObject(_event, formData) {\r\n        const status = formData['status']\r\n        if (status === 'identified') {\r\n            await this.item.setIdentificationStatus(status)\r\n        }\r\n    }\r\n}\r\n", "import { MODULE_ID, getSetting } from './module'\r\n\r\nexport async function createTooltip({\r\n    target,\r\n    selected,\r\n    direction = 'DOWN',\r\n    onCreate,\r\n    onDismiss,\r\n    onClick,\r\n    content,\r\n    cssClass = [],\r\n    locked = false,\r\n}) {\r\n    return new Promise(resolve => {\r\n        const tooltipClass = `${MODULE_ID}-tooltip`\r\n\r\n        const exist = document.body.querySelectorAll(`.${tooltipClass}:not(#tooltip)`)\r\n        for (const el of exist) {\r\n            dismissTooltip(el)\r\n        }\r\n\r\n        requestAnimationFrame(() => {\r\n            cssClass = typeof cssClass === 'string' ? [cssClass] : cssClass\r\n            if (selected) cssClass.push('selection-tooltip')\r\n\r\n            if (Array.isArray(content)) {\r\n                content = content\r\n                    .map(({ value, label }) => {\r\n                        const selectedClass = value === selected ? 'class=\"selected\"' : ''\r\n                        return `<li><a  ${selectedClass} data-value=\"${value}\">${label}</a></li>`\r\n                    })\r\n                    .join('')\r\n            }\r\n\r\n            let tooltip\r\n\r\n            if (content instanceof HTMLElement) {\r\n                tooltip = content\r\n            } else {\r\n                tooltip = document.createElement('ul')\r\n                tooltip.innerHTML = content\r\n            }\r\n\r\n            tooltip.style.setProperty('--font-size', getSetting('scale') + 'px')\r\n\r\n            if (cssClass.length) {\r\n                tooltip.classList.add(...cssClass.map(c => `${MODULE_ID}-${c}`))\r\n            }\r\n\r\n            if (onDismiss) {\r\n                new MutationObserver(function () {\r\n                    if (!document.body.contains(tooltip)) {\r\n                        onDismiss()\r\n                        this.disconnect()\r\n                    }\r\n                }).observe(document.body, { childList: true })\r\n            }\r\n\r\n            if (onClick) {\r\n                locked = true\r\n\r\n                tooltip.querySelectorAll('[data-value]').forEach(el => {\r\n                    el.addEventListener('click', async event => {\r\n                        event.preventDefault()\r\n                        const target = event.currentTarget\r\n                        dismissTooltip(target)\r\n                        onClick?.(target.dataset.value)\r\n                    })\r\n                })\r\n            }\r\n\r\n            game.tooltip.activate(target, { content: tooltip, direction, locked, cssClass: tooltipClass })\r\n\r\n            onCreate?.(tooltip)\r\n\r\n            resolve(tooltip)\r\n        })\r\n    })\r\n}\r\n\r\nexport function dismissTooltip(el) {\r\n    el = el.closest(`.${MODULE_ID}-tooltip`)\r\n    game.tooltip.dismissLockedTooltip(el)\r\n}\r\n", "import { getFlag, getSetting, localize, setFlag } from '../module.js'\r\nimport { IdentifyItemPopup } from '../pf2e/identify.js'\r\nimport { showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, deleteItem, editItem, filterIn, getItemFromEvent, localeCompare } from '../shared.js'\r\nimport { createTooltip, dismissTooltip } from '../tooltip.js'\r\n\r\nconst ITEMS_TYPES = {\r\n    weaponAndShield: { order: 0, label: 'PF2E.Actor.Inventory.Section.WeaponsAndShields' },\r\n    armor: { order: 1, label: 'TYPES.Item.armor' },\r\n    consumable: { order: 2, label: 'PF2E.Item.Consumable.Plural' },\r\n    equipment: { order: 3, label: 'TYPES.Item.equipment' },\r\n    treasure: { order: 4, label: 'TYPES.Item.treasure' },\r\n    backpack: { order: 5, label: 'PF2E.Item.Container.Plural' },\r\n}\r\n\r\nexport async function getItemsData({ actor, filter }) {\r\n    const { contents, coins, totalWealth, bulk, invested } = actor.inventory\r\n    const isCreature = actor.isOfType('creature')\r\n    const openedContainers = getSetting('containers') || (getFlag(actor, `containers.${game.user.id}`) ?? [])\r\n    const containers = {}\r\n    let categories = {}\r\n\r\n    for (const item of contents) {\r\n        const type = item.type === 'shield' || item.type === 'weapon' ? 'weaponAndShield' : item.type\r\n        if (!ITEMS_TYPES[type]) continue\r\n\r\n        const containerId = item.system.containerId\r\n        if (type !== 'backpack' && containerId && (openedContainers === true || openedContainers.includes(containerId))) {\r\n            containers[containerId] ??= []\r\n            containers[containerId].push(item)\r\n        } else {\r\n            categories[type] ??= []\r\n            categories[type].push(item)\r\n        }\r\n    }\r\n\r\n    categories = Object.entries(categories)\r\n        .map(([type, items]) => {\r\n            items.sort((a, b) => localeCompare(a.name, b.name))\r\n            if (type === 'backpack') {\r\n                for (let i = items.length - 1; i >= 0; i--) {\r\n                    const container = items[i]\r\n                    const contained = containers[container.id]?.filter(item => filterIn(item.name, filter))\r\n                    if (!contained?.length) {\r\n                        if (!filterIn(container.name, filter)) items.splice(i, 1)\r\n                        continue\r\n                    }\r\n                    contained.sort((a, b) => localeCompare(a.name, b.name))\r\n                    items.splice(i + 1, 0, ...contained)\r\n                }\r\n            } else items = items.filter(item => filterIn(item.name, filter))\r\n            return {\r\n                type,\r\n                items,\r\n                label: ITEMS_TYPES[type].label,\r\n            }\r\n        })\r\n        .filter(category => category.items.length)\r\n        .sort((a, b) => ITEMS_TYPES[a.type].order - ITEMS_TYPES[b.type].order)\r\n\r\n    if (categories.length) {\r\n        return {\r\n            doubled: categories.length > 1 && getSetting('items-columns'),\r\n            contentData: {\r\n                canCarry: !!actor.adjustCarryType,\r\n                categories,\r\n                bulk,\r\n                containers: openedContainers,\r\n                i18n: str => localize(`items.${str}`),\r\n                invested: invested ? `${game.i18n.localize('PF2E.InvestedLabel')}: ${invested.value} / ${invested.max}` : '',\r\n                wealth: { coins: coins.goldValue, total: totalWealth.goldValue },\r\n                canUseItem: item =>\r\n                    isCreature &&\r\n                    item.type === 'consumable' &&\r\n                    item.isIdentified &&\r\n                    item.uses.max &&\r\n                    (item.formula || ['wand', 'scroll'].includes(item.category)),\r\n                itemDisabled: item => !item.quantity || !item.uses.value || item.system.equipped.carryType === 'dropped',\r\n            },\r\n        }\r\n    }\r\n}\r\n\r\nexport function addItemsListeners({ el, actor, token, hud }) {\r\n    const item = el.find('.item')\r\n\r\n    addNameTooltipListeners(item)\r\n\r\n    item.find('[data-action=item-description]').on('click', async event => {\r\n        event.preventDefault()\r\n        const item = $(event.currentTarget).closest('.item')\r\n        await showItemSummary(item, actor)\r\n    })\r\n\r\n    item.find('[data-action=toggle-contains-items]').on('click', async event => {\r\n        event.preventDefault()\r\n        const flag = `containers.${game.user.id}`\r\n        const containerId = event.currentTarget.closest('.item').dataset.itemId\r\n        const containers = getFlag(actor, flag)?.slice() ?? []\r\n        const index = containers.indexOf(containerId)\r\n        if (index === -1) containers.push(containerId)\r\n        else containers.splice(index, 1)\r\n        await setFlag(actor, flag, containers)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    item.find('[data-action=use-item]').on('click', event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n\r\n        item.consume()\r\n        if (getSetting('use-close')) hud.close()\r\n    })\r\n\r\n    item.find('[data-action=item-chat]').on('click', async event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n\r\n        item.toMessage(event, { create: true })\r\n        if (getSetting('chat-close')) hud.close()\r\n    })\r\n\r\n    item.on('dragstart', event => {\r\n        const target = event.target.closest('.item')\r\n        const { itemType, uuid } = target.dataset\r\n\r\n        const img = new Image()\r\n        img.src = target.querySelector('.item-img img').src\r\n        img.style.width = '32px'\r\n        img.style.height = '32px'\r\n        img.style.borderRadius = '4px'\r\n        img.style.position = 'absolute'\r\n        img.style.left = '-1000px'\r\n        document.body.append(img)\r\n\r\n        event.originalEvent.dataTransfer.setDragImage(img, 16, 16)\r\n        event.originalEvent.dataTransfer.setData(\r\n            'text/plain',\r\n            JSON.stringify({ type: 'Item', fromInventory: true, itemType, uuid })\r\n        )\r\n\r\n        target.addEventListener('dragend', () => img.remove(), { once: true })\r\n    })\r\n\r\n    el.find('.quantity input').on('change', async event => {\r\n        await getItemFromEvent(event, actor)?.update({ 'system.quantity': event.currentTarget.valueAsNumber })\r\n    })\r\n\r\n    el.find('[data-action=toggle-item-invest]').on('click', event => {\r\n        event.preventDefault()\r\n        const { itemId } = event.currentTarget.closest('.item').dataset\r\n        actor.toggleInvested(itemId)\r\n    })\r\n\r\n    el.find('[data-action=repair-item]').on('click', event => {\r\n        event.preventDefault()\r\n        const item = getItemFromEvent(event, actor)\r\n        if (item) game.pf2e.actions.repair({ item, actors: [actor], tokens: [token] })\r\n    })\r\n\r\n    el.find('[data-action=toggle-identified]').on('click', event => {\r\n        event.preventDefault()\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n        if (item.isIdentified) item.setIdentificationStatus('unidentified')\r\n        else new IdentifyItemPopup(item).render(true)\r\n    })\r\n\r\n    el.find('[data-action=edit-item]').on('click', event => {\r\n        event.preventDefault()\r\n        editItem(event, actor)\r\n    })\r\n\r\n    el.find('[data-action=delete-item]').on('click', event => {\r\n        event.preventDefault()\r\n        deleteItem(event, actor)\r\n    })\r\n\r\n    el.find('[data-action=toggle-item-worn').on('click', async event => {\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n\r\n        const tmp = document.createElement('div')\r\n        tmp.innerHTML = await renderTemplate('systems/pf2e/templates/actors/partials/carry-type.hbs', { item })\r\n\r\n        const content = tmp.children[1].firstElementChild\r\n\r\n        content.querySelectorAll('[data-carry-type]').forEach(el => {\r\n            el.addEventListener('click', async event => {\r\n                const menu = event.currentTarget\r\n                const current = item.system.equipped\r\n                const inSlot = menu.dataset.inSlot === 'true'\r\n                const handsHeld = Number(menu.dataset.handsHeld) || 0\r\n                const carryType = menu.dataset.carryType\r\n\r\n                dismissTooltip(menu)\r\n\r\n                if (\r\n                    carryType !== current.carryType ||\r\n                    inSlot !== current.inSlot ||\r\n                    (carryType === 'held' && handsHeld !== current.handsHeld)\r\n                ) {\r\n                    actor.adjustCarryType(item, { carryType, handsHeld, inSlot })\r\n                }\r\n            })\r\n        })\r\n\r\n        if (item.type !== 'backpack') {\r\n            const containers = actor.itemTypes.backpack.filter(container => container.isIdentified)\r\n            if (containers.length) {\r\n                let rows = ''\r\n                for (const container of containers) {\r\n                    rows += '<li><a class=\"item-control item-location-option'\r\n                    if (container === item.container) rows += ' selected'\r\n                    rows += `\" data-action=\"send-to-container\" data-container-id=\"${container.id}\">`\r\n                    rows += `<i class=\"fas fa-box\"></i>${container.name}</a></li>`\r\n                }\r\n\r\n                content.insertAdjacentHTML('beforeend', rows)\r\n                content.querySelectorAll('[data-action=send-to-container]').forEach(el => {\r\n                    el.addEventListener('click', event => {\r\n                        const menu = event.currentTarget\r\n                        const containerId = menu.dataset.containerId\r\n                        if (!actor.items.has(containerId)) return\r\n\r\n                        dismissTooltip(menu)\r\n                        item.update({ 'system.containerId': containerId })\r\n                    })\r\n                })\r\n            }\r\n        }\r\n\r\n        createTooltip({\r\n            target: event.currentTarget,\r\n            content,\r\n            locked: true,\r\n            direction: 'UP',\r\n            selected: true,\r\n        })\r\n    })\r\n}\r\n", "import { getSetting, localize, modifier, MODULE_ID, templatePath } from '../module.js'\r\nimport { ordinalString } from '../pf2e/misc.js'\r\nimport { eventToRollParams } from '../pf2e/scripts.js'\r\nimport { showItemSummary } from '../popup.js'\r\nimport { addNameTooltipListeners, filterIn, getItemFromEvent, localeCompare } from '../shared.js'\r\n\r\nexport async function getSpellsData({ actor, filter }) {\r\n    const focusPool = actor.system.resources.focus ?? { value: 0, max: 0 }\r\n    const entries = actor.spellcasting.regular\r\n    const showTradition = getSetting('tradition')\r\n\r\n    const pf2eStavesActive = game.modules.get('pf2e-staves')?.active\r\n    const pf2eDailies = game.modules.get('pf2e-dailies')\r\n    const pf2eDailiesActive = pf2eDailies?.active\r\n    const stavesActive = pf2eStavesActive || (pf2eDailiesActive && isNewerVersion(pf2eDailies.version, '2.14.0'))\r\n    const chargesPath = pf2eStavesActive\r\n        ? 'flags.pf2e-staves.charges'\r\n        : pf2eDailiesActive\r\n        ? 'flags.pf2e-dailies.staff.charges'\r\n        : ''\r\n\r\n    const spells = []\r\n    const focuses = []\r\n\r\n    let hasFocusCantrips = false\r\n\r\n    await Promise.all(\r\n        entries.map(async entry => {\r\n            const entryId = entry.id\r\n            const tradition = showTradition && entry.statistic.label[0]\r\n            const data = await entry.getSheetData()\r\n            const isFocus = data.isFocusPool\r\n            const isCharge = entry.system?.prepared?.value === 'charge'\r\n\r\n            const charges = (() => {\r\n                if (!isCharge) return\r\n\r\n                const dailiesData = pf2eDailiesActive && pf2eDailies.api.getSpellcastingEntryStaffData(entry)\r\n                const { charges, max, canPayCost } = dailiesData ??\r\n                    getProperty(entry, 'flags.pf2e-staves.charges') ?? { charges: 0, max: 0 }\r\n\r\n                return {\r\n                    value: charges,\r\n                    max,\r\n                    noMax: true,\r\n                    canPayCost: canPayCost ?? (() => true),\r\n                }\r\n            })()\r\n\r\n            for (const slot of data.levels) {\r\n                if (!slot.active.length || slot.uses?.max === 0) continue\r\n\r\n                const slotSpells = []\r\n                const isCantrip = slot.isCantrip\r\n\r\n                for (let slotId = 0; slotId < slot.active.length; slotId++) {\r\n                    const active = slot.active[slotId]\r\n                    if (!active || active.uses?.max === 0) continue\r\n\r\n                    const { spell, expended, virtual, uses, castLevel } = active\r\n                    if (!filterIn(spell.name, filter)) continue\r\n\r\n                    slotSpells.push({\r\n                        name: spell.name,\r\n                        img: spell.img,\r\n                        tradition,\r\n                        castLevel: castLevel ?? spell.level,\r\n                        slotId,\r\n                        entryId,\r\n                        itemId: spell.id,\r\n                        inputId: data.isInnate ? spell.id : data.id,\r\n                        inputPath: isCharge\r\n                            ? chargesPath\r\n                            : data.isInnate\r\n                            ? 'system.location.uses.value'\r\n                            : `system.slots.slot${slot.level}.value`,\r\n                        isCharge,\r\n                        isActiveCharge: isCharge && stavesActive,\r\n                        isVirtual: virtual,\r\n                        isInnate: data.isInnate,\r\n                        isCantrip: isCantrip,\r\n                        isFocus,\r\n                        isPrepared: data.isPrepared,\r\n                        isSpontaneous: data.isSpontaneous || data.isFlexible,\r\n                        slotLevel: slot.level,\r\n                        uses: uses ?? (isCharge ? charges : slot.uses),\r\n                        expended: isCharge\r\n                            ? !charges.canPayCost(slot.level)\r\n                            : expended ?? (isFocus && !isCantrip ? focusPool.value <= 0 : false),\r\n                        action: spell.system.time.value,\r\n                        type: isCharge\r\n                            ? `${MODULE_ID}.spells.staff`\r\n                            : data.isInnate\r\n                            ? 'PF2E.PreparationTypeInnate'\r\n                            : data.isSpontaneous\r\n                            ? 'PF2E.PreparationTypeSpontaneous'\r\n                            : data.isFlexible\r\n                            ? 'PF2E.SpellFlexibleLabel'\r\n                            : isFocus\r\n                            ? 'PF2E.SpellFocusLabel'\r\n                            : 'PF2E.SpellPreparedLabel',\r\n                        order: isCharge ? 0 : data.isPrepared ? 1 : isFocus ? 2 : data.isInnate ? 3 : data.isSpontaneous ? 4 : 5,\r\n                    })\r\n                }\r\n\r\n                if (slotSpells.length) {\r\n                    if (isFocus) {\r\n                        if (isCantrip) hasFocusCantrips = true\r\n                        else {\r\n                            focuses.push(...slotSpells)\r\n                            continue\r\n                        }\r\n                    }\r\n\r\n                    spells[slot.level] ??= []\r\n                    spells[slot.level].push(...slotSpells)\r\n                }\r\n            }\r\n        })\r\n    )\r\n\r\n    if (spells.length) {\r\n        const sortingSetting = getSetting('spells-sort')\r\n        const sort =\r\n            sortingSetting === 'type'\r\n                ? (a, b) => (a.order === b.order ? localeCompare(a.name, b.name) : a.order - b.order)\r\n                : sortingSetting === 'entry'\r\n                ? (a, b) => {\r\n                      const compareEntries = localeCompare(a.entryId, b.entryId)\r\n                      if (compareEntries !== 0) return compareEntries\r\n                      return localeCompare(a.name, b.name)\r\n                  }\r\n                : (a, b) => localeCompare(a.name, b.name)\r\n        spells.forEach(entry => entry.sort(sort))\r\n    }\r\n\r\n    if (focuses.length) {\r\n        focuses.sort((a, b) => localeCompare(a.name, b.name))\r\n        spells[12] = focuses\r\n        hasFocusCantrips = false\r\n    }\r\n\r\n    const ritualData = await actor.spellcasting.ritual?.getSheetData()\r\n    const rituals = ritualData?.levels.flatMap((slot, slotId) =>\r\n        slot.active\r\n            .map(({ spell }) => {\r\n                if (!filterIn(spell.name, filter)) return\r\n                return {\r\n                    name: spell.name,\r\n                    img: spell.img,\r\n                    slotId,\r\n                    itemId: spell.id,\r\n                    level: spell.level,\r\n                    time: spell.system.time.value,\r\n                }\r\n            })\r\n            .filter(Boolean)\r\n    )\r\n\r\n    if (spells.length || rituals?.length) {\r\n        const attacks = getSpellAttacks(actor)\r\n\r\n        const nb = spells.length + Number((rituals?.length ?? 0) > 0)\r\n        return {\r\n            contentData: {\r\n                spells,\r\n                rituals,\r\n                focusPool,\r\n                hasFocusCantrips,\r\n                attackMod: hasSingleSpellAttack(attacks) ? attacks[0].mod : null,\r\n                entryRank: rank => game.i18n.format('PF2E.Item.Spell.Rank.Ordinal', { rank: ordinalString(rank) }),\r\n            },\r\n            doubled: nb > 1 && getSetting('spells-columns'),\r\n        }\r\n    }\r\n}\r\n\r\nfunction getSpellAttacks(actor) {\r\n    return actor.spellcasting\r\n        .filter(entry => entry.statistic)\r\n        .map(({ statistic, name, id }) => ({ name, id, mod: modifier(statistic.mod), statistic }))\r\n}\r\n\r\nfunction hasSingleSpellAttack(attacks) {\r\n    return new Set(attacks.map(({ mod }) => mod)).size === 1\r\n}\r\n\r\nexport function addSpellsListeners({ el, actor, hud }) {\r\n    addNameTooltipListeners(el.find('.spell'))\r\n\r\n    el.find('[data-action=spell-description]').on('click', async event => {\r\n        event.preventDefault()\r\n        const spell = $(event.currentTarget).closest('.spell')\r\n        showItemSummary(spell, actor)\r\n    })\r\n\r\n    // IS OWNER\r\n    if (!actor.isOwner) return\r\n\r\n    el.find('[data-action=spell-attack]').on('click', async event => {\r\n        event.preventDefault()\r\n\r\n        const attacks = getSpellAttacks(actor)\r\n        if (!attacks.length) return\r\n\r\n        let statistic\r\n        if (!hasSingleSpellAttack(attacks)) {\r\n            const id = await Dialog.wait({\r\n                buttons: {\r\n                    ok: {\r\n                        icon: '<i class=\"fa-solid fa-dice-d20\"></i>',\r\n                        label: localize('spells.attacks.ok'),\r\n                        callback: html => html.find('input:checked').val(),\r\n                    },\r\n                },\r\n                title: localize('spells.attacks.title'),\r\n                content: await renderTemplate(templatePath('dialogs/spell-attacks'), { attacks }),\r\n                close: () => null,\r\n            })\r\n\r\n            if (id) statistic = actor.items.get(id)?.statistic\r\n        } else {\r\n            statistic = attacks[0].statistic\r\n        }\r\n\r\n        const rollParams = eventToRollParams(event, { type: 'check' })\r\n        const { map } = event.currentTarget.dataset\r\n        if (map) {\r\n            rollParams.modifiers = [new game.pf2e.Modifier({ label: 'PF2E.MultipleAttackPenalty', modifier: Number(map) })]\r\n        }\r\n\r\n        statistic?.check.roll(rollParams)\r\n    })\r\n\r\n    el.find('[data-action=spell-chat]').on('click', async event => {\r\n        event.preventDefault()\r\n\r\n        const item = getItemFromEvent(event, actor)\r\n        if (!item) return\r\n\r\n        item.toMessage(event, { create: true })\r\n        if (getSetting('chat-close')) hud.close()\r\n    })\r\n\r\n    el.find('[data-action=toggle-pips]').on('click contextmenu', async event => {\r\n        event.preventDefault()\r\n        const change = event.type === 'click' ? 1 : -1\r\n        const points = (actor.system.resources.focus?.value ?? 0) + change\r\n        await actor.update({ 'system.resources.focus.value': points })\r\n    })\r\n\r\n    el.find('[data-action=toggle-prepared]').on('click', event => {\r\n        event.preventDefault()\r\n        const { slotLevel, slotId, entryId, expended } = $(event.currentTarget).closest('.spell').data()\r\n        const collection = actor.spellcasting.collections.get(entryId)\r\n        collection?.setSlotExpendedState(slotLevel ?? 0, slotId ?? 0, expended !== true)\r\n    })\r\n\r\n    el.find('[data-action=cast-spell]').on('click', event => {\r\n        event.preventDefault()\r\n\r\n        const { slotLevel, slotId, entryId, itemId } = $(event.currentTarget).closest('.spell').data()\r\n        const collection = actor.spellcasting.collections.get(entryId, { strict: true })\r\n        if (!collection) return\r\n\r\n        const spell = collection.get(itemId, { strict: true })\r\n        if (!spell) return\r\n\r\n        collection.entry.cast(spell, { slot: slotId, level: slotLevel })\r\n        if (getSetting('cast-close')) hud.close()\r\n    })\r\n\r\n    el.find('[data-input-path]').on('change', async event => {\r\n        const { inputPath, entryId } = $(event.currentTarget).data()\r\n        const value = event.currentTarget.valueAsNumber\r\n        await actor.updateEmbeddedDocuments('Item', [{ _id: entryId, [inputPath]: value }])\r\n    })\r\n}\r\n", "import { useResolve } from './actions/use-resolve.js'\r\nimport { enrichHTML, getFlag, getSetting, localize, modifier, MODULE_ID, setFlag, templatePath } from './module.js'\r\nimport { getChatMessageClass, getDamageRollClass } from './pf2e/classes.js'\r\nimport { popup } from './popup.js'\r\nimport { getCoverEffect, getUniqueTarget, localeCompare, RANKS } from './shared.js'\r\nimport { addActionsListeners, getActionsData } from './sidebars/actions.js'\r\nimport { addExtrasListeners, getExtrasData } from './sidebars/extras.js'\r\nimport { addHazardListeners, getHazardData } from './sidebars/hazard.js'\r\nimport { addItemsListeners, getItemsData } from './sidebars/items.js'\r\nimport { addSkillsListeners, getSkillsData } from './sidebars/skills.js'\r\nimport { addSpellsListeners, getSpellsData } from './sidebars/spells.js'\r\nimport { createTooltip } from './tooltip.js'\r\n\r\nconst HOVER_EXCEPTIONS = [\r\n    '#combat-popout',\r\n    '#sidebar',\r\n    '#mini-tracker',\r\n    '#combat-dock',\r\n    '#combat-carousel',\r\n    '[id^=pf2e-perception]',\r\n].join(', ')\r\n\r\nconst POSITIONS = {\r\n    left: ['left', 'right', 'top', 'bottom'],\r\n    right: ['right', 'left', 'top', 'bottom'],\r\n    top: ['top', 'bottom', 'left', 'right'],\r\n    bottom: ['bottom', 'top', 'left', 'right'],\r\n}\r\n\r\nconst ALLIANCES = {\r\n    opposition: { icon: 'fa-solid fa-face-angry-horns', label: 'PF2E.Actor.Creature.Alliance.Opposition' },\r\n    party: { icon: 'fa-solid fa-face-smile-halo', label: 'PF2E.Actor.Creature.Alliance.Party' },\r\n    neutral: { icon: 'fa-solid fa-face-meh', label: 'PF2E.Actor.Creature.Alliance.Neutral' },\r\n}\r\n\r\nconst SPEEDS = [\r\n    { type: 'land', icon: 'fa-solid fa-shoe-prints' },\r\n    { type: 'burrow', icon: 'fa-solid fa-chevrons-down' },\r\n    { type: 'climb', icon: 'fa-solid fa-spider' },\r\n    { type: 'fly', icon: 'fa-solid fa-feather' },\r\n    { type: 'swim', icon: 'fa-solid fa-person-swimming' },\r\n]\r\n\r\nconst SIDEBARS = {\r\n    actions: { getData: getActionsData, addListeners: addActionsListeners },\r\n    items: { getData: getItemsData, addListeners: addItemsListeners },\r\n    spells: { getData: getSpellsData, addListeners: addSpellsListeners },\r\n    skills: { getData: getSkillsData, addListeners: addSkillsListeners },\r\n    extras: { getData: getExtrasData, addListeners: addExtrasListeners },\r\n    hazard: { getData: getHazardData, addListeners: addHazardListeners },\r\n}\r\n\r\nconst SAVES = {\r\n    fortitude: { icon: 'fa-solid fa-chess-rook', label: 'PF2E.SavesFortitude' },\r\n    reflex: { icon: 'fa-solid fa-person-running', label: 'PF2E.SavesReflex' },\r\n    will: { icon: 'fa-solid fa-brain', label: 'PF2E.SavesWill' },\r\n}\r\n\r\nconst SKILLS = {\r\n    perception: { icon: 'fa-solid fa-eye', label: 'PF2E.PerceptionLabel' },\r\n    stealth: { icon: 'fa-duotone fa-eye-slash', label: 'PF2E.SkillStealth' },\r\n    athletics: { icon: 'fa-solid fa-hand-fist', label: 'PF2E.SkillAthletics' },\r\n}\r\n\r\nexport class HUD extends Application {\r\n    #token = null\r\n    #lastToken = null\r\n    #hoveredToken = null\r\n    #delay = null\r\n    #holding = false\r\n    #closing = null\r\n    #mousedown = [false, false, false]\r\n    #lock = false\r\n    #softLock = false\r\n    #isObserved = false\r\n    #hoverTokenHandler\r\n    #mouseeventHandler\r\n    #deleteTokenHandler\r\n\r\n    constructor() {\r\n        super()\r\n\r\n        this.forceClose = () => this.close({ force: true })\r\n\r\n        this.#hoverTokenHandler = (token, hover) => {\r\n            if (hover) this.#tokenEnter(token)\r\n            else this.#tokenLeave(token)\r\n        }\r\n\r\n        this.#mouseeventHandler = event => {\r\n            const button = event.button\r\n            if (![0, 2].includes(button)) return\r\n\r\n            if (event.type === 'mouseup') {\r\n                this.#mousedown[button] = false\r\n                return\r\n            }\r\n\r\n            this.#mousedown[button] = true\r\n\r\n            const target = event.target\r\n            const el = this.element[0]\r\n\r\n            if (el) {\r\n                const popup = el.querySelector('.popup')\r\n\r\n                if (popup && !popup.contains(target)) {\r\n                    if (!el.querySelector('.sidebar')) this.forceClose()\r\n                    else return popup.remove()\r\n                }\r\n\r\n                if (target.closest('canvas')) this.forceClose()\r\n\r\n                return\r\n            } else this.#cancelDelay()\r\n\r\n            this.unlock(true)\r\n        }\r\n\r\n        this.#deleteTokenHandler = token => {\r\n            if (this.#token && token.id === this.#token.id) this.forceClose()\r\n        }\r\n\r\n        window.addEventListener('mousedown', this.#mouseeventHandler)\r\n        window.addEventListener('mouseup', this.#mouseeventHandler)\r\n\r\n        Hooks.on('hoverToken', this.#hoverTokenHandler)\r\n        Hooks.on('deleteToken', this.#deleteTokenHandler)\r\n        Hooks.on('canvasPan', this.forceClose)\r\n    }\r\n\r\n    setToken(token, isObserved) {\r\n        if (token !== this.#token) {\r\n            delete this.#token?.actor?.apps[this.appId]\r\n\r\n            this.#token = token\r\n            const actor = token?.actor\r\n            if (actor) actor.apps[this.appId] = this\r\n        }\r\n        this.#isObserved = isObserved ?? this.#checkIfObserved(token)\r\n    }\r\n\r\n    setHolding(held) {\r\n        const holding = getSetting('use-holding')\r\n        if (holding === 'none') return\r\n\r\n        this.#holding = held\r\n\r\n        if (this.#softLock || this.#lock) return\r\n\r\n        if (held) {\r\n            if (!this.#hoveredToken) return\r\n            const isObserved = this.#checkIfObserved(this.#hoveredToken)\r\n            if (holding === 'half' && !game.user.isGM && !isObserved) {\r\n                this.#cancelDelay()\r\n                this.render()\r\n                return\r\n            }\r\n            this.setToken(this.#hoveredToken, isObserved)\r\n            this.render()\r\n        } else {\r\n            if (holding === 'all') this.close()\r\n            else if (game.user.isGM) {\r\n                this.setToken(this.#hoveredToken)\r\n                this.render()\r\n            } else if (this.#isObserved) this.close()\r\n        }\r\n    }\r\n\r\n    #checkIfObserved(token) {\r\n        const actor = token?.actor\r\n        if (!actor) return false\r\n\r\n        let isObserved\r\n        const isParty = actor.system.details.alliance === 'party'\r\n\r\n        if (game.user.isGM && getSetting('use-holding') === 'half' && !this.#holding) isObserved = false\r\n        else if (actor.isOfType('familiar') && !actor.master) isObserved = false\r\n        else isObserved = token.isOwner || (getSetting('observer') && (token.observer || (isParty && getSetting('party'))))\r\n\r\n        return isObserved\r\n    }\r\n\r\n    #tokenEnter(token) {\r\n        if ($(window.document).find(':hover').filter(HOVER_EXCEPTIONS).length) return\r\n\r\n        const actor = token.actor\r\n        if (!actor || actor.isOfType('loot', 'party')) return\r\n\r\n        if (token.document.disposition === CONST.TOKEN_DISPOSITIONS.SECRET && !actor.isOwner) return\r\n\r\n        if (actor.isOfType('npc') && getSetting('no-dead') && actor.isDead) return\r\n\r\n        this.#hoveredToken = token\r\n\r\n        if (token !== this.#lastToken && !this.#lock) this.close()\r\n\r\n        if (this.mousedown || this.#lock || this.#softLock || token === this.#token) return\r\n\r\n        const holding = getSetting('use-holding')\r\n        const isObserved = this.#checkIfObserved(token)\r\n        if (holding !== 'none' && !this.#holding && (holding === 'all' || isObserved)) return\r\n\r\n        this.#cancelClosing(true)\r\n        this.setToken(token, isObserved)\r\n\r\n        if (holding === 'none' || !this.#holding) this.renderWithDelay()\r\n        else this.render()\r\n    }\r\n\r\n    #tokenLeave(token) {\r\n        this.#hoveredToken = null\r\n\r\n        if (this.mousedown || this.#lock || this.#softLock) return\r\n\r\n        this.#closing = setTimeout(() => {\r\n            this.#closing = null\r\n            if (this.#softLock || this.#lock) return\r\n            this.close()\r\n        }, 10)\r\n    }\r\n\r\n    renderWithDelay() {\r\n        let delay = getSetting('delay')\r\n        if (delay) {\r\n            if (delay < 10) delay = 10\r\n            this.#delay = setTimeout(() => {\r\n                this.#delay = null\r\n                this.render()\r\n            }, delay)\r\n        } else this.render()\r\n    }\r\n\r\n    #cancelClosing(close) {\r\n        if (this.#closing === null) return\r\n        clearTimeout(this.#closing)\r\n        this.#closing = null\r\n        if (close) this.close()\r\n    }\r\n\r\n    #cancelDelay() {\r\n        if (this.#delay === null) return\r\n        clearTimeout(this.#delay)\r\n        this.#delay = null\r\n    }\r\n\r\n    delete() {\r\n        this.forceClose()\r\n\r\n        window.removeEventListener('mousedown', this.#mouseeventHandler)\r\n        window.removeEventListener('mouseup', this.#mouseeventHandler)\r\n\r\n        Hooks.off('hoverToken', this.#hoverTokenHandler)\r\n        Hooks.off('deleteToken', this.#deleteTokenHandler)\r\n        Hooks.off('canvasPan', this.forceClose)\r\n    }\r\n\r\n    static get defaultOptions() {\r\n        return mergeObject(super.defaultOptions, {\r\n            popOut: false,\r\n            minimizable: false,\r\n            template: templatePath('hud'),\r\n        })\r\n    }\r\n\r\n    get mousedown() {\r\n        return this.#mousedown[0] || this.#mousedown[2]\r\n    }\r\n\r\n    get token() {\r\n        return this.#token\r\n    }\r\n\r\n    get actor() {\r\n        return this.#token?.actor\r\n    }\r\n\r\n    get hasCover() {\r\n        return !!getCoverEffect(this.actor)\r\n    }\r\n\r\n    get sidebar() {\r\n        return this.element?.find('> .sidebar') ?? []\r\n    }\r\n\r\n    get popup() {\r\n        return this.element?.find('> .popup') ?? []\r\n    }\r\n\r\n    get inner() {\r\n        return this.element?.find('> .inner') ?? []\r\n    }\r\n\r\n    async getData() {\r\n        const token = this.#token\r\n        const actor = this.#token?.actor\r\n        if (!actor) return {}\r\n\r\n        let distance = null\r\n        const savesSetting = getSetting('saves')\r\n        const othersSetting = getSetting('others')\r\n        const isCharacter = actor.isOfType('character')\r\n        const { attributes } = actor\r\n        const { hp, ac } = attributes\r\n        const sp = hp.sp ?? { max: 0, value: 0 }\r\n        const useStamina = game.settings.get('pf2e', 'staminaVariant')\r\n        const showDistance = getSetting('distance')\r\n        const fontSize = getSetting('scale')\r\n\r\n        if (showDistance === 'all' || (showDistance === 'self' && this.#isObserved)) {\r\n            const unitSplit = getSetting('unit').split(',')\r\n            const multiplier = Number(unitSplit[0]?.trim()) || 1\r\n            const unit = unitSplit[1]?.trim() || game.system.gridUnits\r\n            const decimals = Number(unitSplit[2]?.trim()) || 0\r\n            const selected = canvas.tokens.controlled\r\n\r\n            let isTarget = false\r\n            let target = selected.length === 1 ? selected[0] : null\r\n\r\n            if (!target || target === token) {\r\n                target = getUniqueTarget()\r\n                isTarget = true\r\n            }\r\n\r\n            if (target && target !== token) {\r\n                distance = {\r\n                    unit,\r\n                    icon: isTarget ? '<i class=\"fa-solid fa-crosshairs-simple\"></i>' : '<i class=\"fa-solid fa-expand\"></i>',\r\n                    range: (token.distanceTo(target) * multiplier).toFixed(decimals),\r\n                }\r\n            }\r\n        }\r\n\r\n        let status\r\n        if (!this.#isObserved || getSetting('see-status')) {\r\n            const statuses = getSetting('status')\r\n                .split(',')\r\n                .map(x => x.trim())\r\n                .filter(Boolean)\r\n\r\n            if (statuses.length && hp.max) {\r\n                const max = hp.max + (useStamina ? sp.max : 0)\r\n                const current = hp.value + (useStamina ? sp.value : 0)\r\n                const ratio = Math.clamped(current / max, 0, 1)\r\n                const pick = (() => {\r\n                    const length = statuses.length\r\n                    if (getSetting('last-status')) {\r\n                        if (ratio === 1) return length\r\n                        return Math.ceil(ratio * (length - 1))\r\n                    }\r\n                    return Math.ceil(ratio * length)\r\n                })()\r\n\r\n                status = {\r\n                    hue: ratio * ratio * 122 + 3,\r\n                    value: pick === 0 ? game.i18n.localize('EFFECT.StatusDead') : statuses.at(pick - 1),\r\n                }\r\n            }\r\n        }\r\n\r\n        let sharedData = {\r\n            status,\r\n            distance,\r\n            fontSize,\r\n            tokenId: token.id,\r\n            type: actor.isOfType('creature') ? 'creature' : actor.type,\r\n        }\r\n\r\n        if (!this.#isObserved || (actor.isOfType('familiar') && !actor.master)) return sharedData\r\n\r\n        const { level, saves, isOwner, system, itemTypes } = actor\r\n        const { resistances, weaknesses, immunities } = attributes\r\n\r\n        sharedData = {\r\n            ...sharedData,\r\n            isOwner,\r\n            isObserver: this.#isObserved,\r\n            name: token.document.name,\r\n            hp,\r\n            ac: ac.value,\r\n            level,\r\n            hasActions: itemTypes.action.length || system.actions?.filter(action => action.visible !== false).length,\r\n        }\r\n\r\n        const showRanks = getSetting('ranks')\r\n\r\n        function getStatistic(stat, type, stats) {\r\n            const slug = stat.slug\r\n            const value = type === 'bonus' ? modifier(stat.mod) : stat.dc.value\r\n            return { slug, value, label: stats[slug].label, icon: stats[slug].icon, rank: showRanks && RANKS[stat.rank] }\r\n        }\r\n\r\n        function toIWR(category, header) {\r\n            if (!category.length) return ''\r\n            const rows = category.map(x => toInfo(x.label.replace('-', ' ').titleCase())).join('')\r\n            if (!header) return rows\r\n            return `<li>${game.i18n.localize(header)}<ul>` + rows + '</ul></li>'\r\n        }\r\n\r\n        if (actor.isOfType('hazard')) {\r\n            const { hardness, emitsSound, stealth } = attributes\r\n\r\n            return {\r\n                ...sharedData,\r\n                hardness,\r\n                emitsSound: emitsSound.toString().capitalize(),\r\n                immunities: toIWR(immunities),\r\n                weaknesses: toIWR(weaknesses),\r\n                resistances: toIWR(resistances),\r\n                stealth: {\r\n                    value: stealth.value,\r\n                    details: await enrichHTML(stealth.details, actor),\r\n                },\r\n                saves:\r\n                    savesSetting !== 'none' &&\r\n                    ['fortitude', 'reflex', 'will'].map(slug => {\r\n                        const save = saves[slug]\r\n                        if (!save) return { slug, label: SAVES[slug].label, icon: SAVES[slug].icon }\r\n                        return getStatistic(save, savesSetting, SAVES)\r\n                    }),\r\n            }\r\n        }\r\n\r\n        sharedData = {\r\n            ...sharedData,\r\n            sidebarTitles: {\r\n                actions: `${MODULE_ID}.actions.title`,\r\n                items: `${MODULE_ID}.items.title`,\r\n                spells: `${MODULE_ID}.spells.title`,\r\n                skills: `${MODULE_ID}.skills.title`,\r\n                extras: `${MODULE_ID}.extras.title`,\r\n            },\r\n            hasItems: actor.inventory.size,\r\n        }\r\n\r\n        if (actor.isOfType('vehicle')) {\r\n            const { hardness, collisionDC, collisionDamage } = attributes\r\n            const { details } = system\r\n            const { crew, passengers, pilotingCheck, speed } = details\r\n\r\n            return {\r\n                ...sharedData,\r\n                hardness,\r\n                crew,\r\n                passengers,\r\n                pilotingCheck,\r\n                speed,\r\n                collisionDC: collisionDC.value,\r\n                collisionDamage: collisionDamage.value,\r\n                immunities: toIWR(immunities),\r\n                weaknesses: toIWR(weaknesses),\r\n                resistances: toIWR(resistances),\r\n                fortitude: getStatistic(saves.fortitude, savesSetting, SAVES),\r\n            }\r\n        }\r\n\r\n        const showDeath = getSetting('show-death')\r\n        const { heroPoints } = actor\r\n        const { traits, resources } = system\r\n        const { wounded, dying, shield, speed, adjustment } = attributes\r\n\r\n        function toInfo(str) {\r\n            return `<li>${str.trim()}</li>`\r\n        }\r\n\r\n        function sort(a, b) {\r\n            return localeCompare(a, b)\r\n        }\r\n\r\n        const languages = traits?.languages?.value\r\n            .map(x => game.i18n.localize(CONFIG.PF2E.languages[x]))\r\n            .filter(Boolean)\r\n            .sort(sort)\r\n            .map(toInfo)\r\n            .join('')\r\n\r\n        const senses = isCharacter ? traits.senses.map(x => x.label) : traits.senses.value?.split(',')\r\n\r\n        const speeds = SPEEDS.map(({ type, icon }, index) => ({\r\n            index,\r\n            icon,\r\n            label: game.i18n.localize(CONFIG.PF2E.speedTypes[type] ?? 'PF2E.SpeedTypesLand'),\r\n            value: (index === 0 ? speed.total : speed.otherSpeeds.find(s => s.type === type)?.total) || 0,\r\n        }))\r\n\r\n        const selectedSpeed = getFlag(actor, `speeds.selected.${game.user.id}`)\r\n        const mainSpeed = (() => {\r\n            let index = 0\r\n            if (selectedSpeed !== undefined) index = selectedSpeed\r\n            else if (getSetting('force-speed') || speeds[0].value === 0) {\r\n                const base = { index: 0, value: speeds[0].value }\r\n                index = speeds.reduce((prev, { value }, index) => (value > prev.value ? { index, value } : prev), base).index\r\n            }\r\n            return speeds.splice(index, 1)[0]\r\n        })()\r\n\r\n        let otherSpeeds = speeds\r\n            .map(({ value, label, index }) => `<li><a data-value=\"${index}\">${label}: ${value}</a></li>`)\r\n            .join('')\r\n        if (speed.details) otherSpeeds += `<li>${game.i18n.localize('PF2E.DetailsHeading')}: ${speed.details}</li>`\r\n\r\n        return {\r\n            ...sharedData,\r\n            sp: useStamina ? sp : { max: 0 },\r\n            hero: heroPoints,\r\n            dying,\r\n            wounded,\r\n            shield,\r\n            resolve: resources.resolve,\r\n            adjustment,\r\n            alliance: ALLIANCES[getAlliance(actor).alliance],\r\n            isCharacter,\r\n            showDeathLine: isCharacter && (showDeath === 'always' || dying.value || wounded.value),\r\n            digitalPips: getSetting('pips'),\r\n            hasCover: this.hasCover,\r\n            saves:\r\n                savesSetting !== 'none' &&\r\n                ['fortitude', 'reflex', 'will'].map(slug => getStatistic(saves[slug], savesSetting, SAVES)),\r\n            others:\r\n                othersSetting !== 'none' &&\r\n                ['perception', 'stealth', 'athletics'].map(slug => getStatistic(actor.getStatistic(slug), othersSetting, SKILLS)),\r\n            speeds: {\r\n                main: mainSpeed,\r\n                others: otherSpeeds,\r\n            },\r\n            iwr:\r\n                toIWR(immunities, 'PF2E.ImmunitiesLabel') +\r\n                toIWR(weaknesses, 'PF2E.WeaknessesLabel') +\r\n                toIWR(resistances, 'PF2E.ResistancesLabel'),\r\n            senses: senses?.filter(Boolean).map(toInfo).join(''),\r\n            languages,\r\n            hasSpells: actor.spellcasting.some(x => x.category !== 'items'),\r\n            hasNotes: !isCharacter && (system.details.publicNotes || (system.details.privateNotes && isOwner)),\r\n        }\r\n    }\r\n\r\n    close(options = {}) {\r\n        this.setToken(null)\r\n        this.unlock(true)\r\n        this.#softLock = false\r\n\r\n        this.#cancelDelay()\r\n\r\n        const states = Application.RENDER_STATES\r\n        if (!options.force && ![states.RENDERED, states.ERROR].includes(this._state)) return\r\n\r\n        this._state = states.CLOSING\r\n\r\n        let el = this.element\r\n        if (!el) return (this._state = states.CLOSED)\r\n        el.css({ minHeight: 0 })\r\n\r\n        for (let cls of this.constructor._getInheritanceChain()) {\r\n            Hooks.call(`close${cls.name}`, this, el)\r\n        }\r\n\r\n        el.remove()\r\n\r\n        this._element = null\r\n        this._state = states.CLOSED\r\n        delete ui.windows[this.appId]\r\n    }\r\n\r\n    async _render(force = false, options = {}) {\r\n        let sidebarType\r\n        let sidebarScrolltop\r\n        let popup\r\n        let popupScrollTop\r\n        let filter\r\n\r\n        if (this.#lastToken === this.#token) {\r\n            const sidebar = this.sidebar[0]\r\n            if (sidebar) {\r\n                sidebarType = sidebar.dataset.type\r\n                sidebarScrolltop = sidebar.scrollTop\r\n                const filterHeader = sidebar.querySelector('.sidebar-header')\r\n                if (filterHeader.classList.contains('show')) filter = filterHeader.querySelector(' input').value.trim()\r\n            }\r\n\r\n            popup = this.popup[0]\r\n            if (popup) popupScrollTop = popup.scrollTop\r\n        }\r\n\r\n        await super._render(force, options)\r\n        ui.windows[this.appId] = this\r\n\r\n        if (sidebarType) {\r\n            const sidebar = await this.#openSidebar(sidebarType, filter)\r\n            if (sidebarScrolltop > 0) sidebar.scrollTop(sidebarScrolltop)\r\n        }\r\n\r\n        if (popup) {\r\n            this.element.append(popup)\r\n            if (popupScrollTop > 0) popup.scrollTop = popupScrollTop\r\n        }\r\n\r\n        this.#lastToken = this.#token\r\n\r\n        if (!this.inner.length) return\r\n        if (getSetting('autolock') === 'render') this.lock()\r\n    }\r\n\r\n    render() {\r\n        if (this.actor) super.render(true)\r\n    }\r\n\r\n    _injectHTML(html) {\r\n        $('body').append(html)\r\n        this._element = html\r\n    }\r\n\r\n    setPosition() {\r\n        const token = this.#token\r\n        if (!token) return\r\n\r\n        const element = this.element[0]\r\n        const scale = token.worldTransform.a\r\n        const hud = element.getBoundingClientRect()\r\n        const targetCoords = canvas.clientCoordinatesFromCanvas(token.document._source)\r\n        const target = {\r\n            x: targetCoords.x,\r\n            y: targetCoords.y,\r\n            width: token.hitArea.width * scale,\r\n            height: token.hitArea.height * scale,\r\n            get right() {\r\n                return this.x + this.width\r\n            },\r\n            get bottom() {\r\n                return this.y + this.height\r\n            },\r\n        }\r\n\r\n        let coords\r\n\r\n        const positions = this.#isObserved\r\n            ? POSITIONS[getSetting('position')].slice()\r\n            : POSITIONS[getSetting('small-position')].slice()\r\n\r\n        while (positions.length && !coords) {\r\n            const position = positions.shift()\r\n\r\n            if (position === 'left') {\r\n                coords = {\r\n                    x: target.x - hud.width,\r\n                    y: postionFromTargetY(hud, target),\r\n                }\r\n                if (coords.x < 0) coords = undefined\r\n            } else if (position === 'right') {\r\n                coords = {\r\n                    x: target.right,\r\n                    y: postionFromTargetY(hud, target),\r\n                }\r\n                if (coords.x + hud.width > window.innerWidth) coords = undefined\r\n            } else if (position === 'top') {\r\n                coords = {\r\n                    x: postionFromTargetX(hud, target),\r\n                    y: target.y - hud.height,\r\n                }\r\n                if (coords.y < 0) coords = undefined\r\n            } else if (position === 'bottom') {\r\n                coords = {\r\n                    x: postionFromTargetX(hud, target),\r\n                    y: target.bottom,\r\n                }\r\n                if (coords.y + hud.height > window.innerHeight) coords = undefined\r\n            }\r\n        }\r\n\r\n        if (coords) {\r\n            element.style.left = `${coords.x}px`\r\n            element.style.top = `${coords.y}px`\r\n        }\r\n\r\n        return coords\r\n    }\r\n\r\n    lock() {\r\n        this.#lock = true\r\n    }\r\n\r\n    unlock(force) {\r\n        if (!force && (this.sidebar.length || getSetting('autolock') !== 'none')) return\r\n        this.#lock = false\r\n    }\r\n\r\n    activateListeners(html) {\r\n        const token = this.#token\r\n        const actor = token?.actor\r\n        if (!actor) return\r\n\r\n        const isOwner = token.isOwner\r\n        const ChatMessagePF2e = getChatMessageClass()\r\n\r\n        if (getSetting('tooltips')) {\r\n            html.find('.inner [data-tooltip]').attr('data-tooltip', '')\r\n        }\r\n\r\n        html.find('[data-action=show-notes').on('click', async event => {\r\n            event.preventDefault()\r\n\r\n            const { publicNotes, privateNotes, blurb } = actor.system.details\r\n            const traits = actor.system.traits.value.map(trait => ({\r\n                label: game.i18n.localize(CONFIG.PF2E.creatureTraits[trait]) ?? trait,\r\n                description: game.i18n.localize(CONFIG.PF2E.traitsDescriptions[trait]) ?? '',\r\n            }))\r\n\r\n            const content = await renderTemplate(templatePath('show-notes'), {\r\n                traits,\r\n                blurb: blurb.trim(),\r\n                publicNotes: publicNotes.trim(),\r\n                privateNotes: isOwner && privateNotes.trim(),\r\n            })\r\n\r\n            popup(`${actor.name} - ${game.i18n.localize('PF2E.NPC.NotesTab')}`, content, actor)\r\n        })\r\n\r\n        html.on('mousedown', () => this.bringToTop())\r\n\r\n        html.on('mouseenter', () => {\r\n            if (!html.find('.inner').length) return\r\n            if (getSetting('autolock') === 'hover') this.lock()\r\n            this.#softLock = true\r\n        })\r\n\r\n        html.on('mouseleave', () => {\r\n            this.#softLock = false\r\n            if (this.#lock || this.#hoveredToken) return\r\n            this.close()\r\n        })\r\n\r\n        html.on('dragover', () => {\r\n            if (token.isOwner && html.find('> .sidebar.extras').length && !html.find('> .popup').length) return\r\n            html.css('opacity', 0.1)\r\n            html.css('pointerEvents', 'none')\r\n            window.addEventListener(\r\n                'dragend',\r\n                () => {\r\n                    html.css('opacity', 1)\r\n                    html.css('pointerEvents', '')\r\n                },\r\n                { once: true }\r\n            )\r\n        })\r\n\r\n        const infos = html.find('[data-action=show-info]')\r\n        const infosElements = isOwner ? infos.filter(':not(.speeds)') : infos\r\n        infosElements.on('click', event => {\r\n            const target = event.currentTarget\r\n            const content = target.dataset.tooltipContent\r\n\r\n            if (target.classList.contains('stealth')) {\r\n                this.#createHUDLockedListTooltip({ content, event, direction: 'DOWN' })\r\n            } else {\r\n                createTooltip({ target, content, direction: 'UP' })\r\n            }\r\n        })\r\n\r\n        html.find('[data-action=open-sidebar]').on('click', this.#openSidebar.bind(this))\r\n\r\n        // IS OWNER\r\n        if (!isOwner) return\r\n\r\n        html.find('[data-action=toggle-adjustment]').on('click contextmenu', event => {\r\n            event.preventDefault()\r\n            const adjustment = event.type === 'click' ? 'elite' : 'weak'\r\n            actor.applyAdjustment(actor.system.attributes.adjustment === adjustment ? null : adjustment)\r\n        })\r\n\r\n        html.find('[data-action=toggle-alliance]').on('click', event => {\r\n            const { originalAlliance, defaultAlliance } = getAlliance(actor)\r\n\r\n            const content = [\r\n                {\r\n                    value: 'default',\r\n                    label: game.i18n.format('PF2E.Actor.Creature.Alliance.Default', {\r\n                        alliance: game.i18n.localize(ALLIANCES[defaultAlliance].label),\r\n                    }),\r\n                },\r\n                { value: 'opposition', label: game.i18n.localize(ALLIANCES.opposition.label) },\r\n                { value: 'party', label: game.i18n.localize(ALLIANCES.party.label) },\r\n                { value: 'neutral', label: game.i18n.localize(ALLIANCES.neutral.label) },\r\n            ]\r\n\r\n            this.#createHUDLockedListTooltip({\r\n                content,\r\n                event,\r\n                selected: originalAlliance,\r\n                onClick: value => {\r\n                    if (value === 'default') actor.update({ 'system.details.-=alliance': null })\r\n                    else actor.update({ 'system.details.alliance': value === 'neutral' ? null : value })\r\n                },\r\n            })\r\n        })\r\n\r\n        html.find('[data-action=collision-dc]').on('click', event => {\r\n            event.preventDefault()\r\n            const dc = actor.system.attributes.collisionDC.value || 15\r\n            ChatMessagePF2e.create({\r\n                content: `@Check[type:reflex|dc:${dc}]`,\r\n                speaker: ChatMessagePF2e.getSpeaker({ actor }),\r\n            })\r\n        })\r\n\r\n        html.find('[data-action=collision-damage]').on('click', async event => {\r\n            event.preventDefault()\r\n            let formula = (actor.system.attributes.collisionDamage.value || '1d6').trim()\r\n            if (!isNaN(Number(formula.at(-1)))) formula += '[bludgeoning]'\r\n            const DamageRoll = getDamageRollClass()\r\n            const roll = await new DamageRoll(formula).evaluate({ async: true })\r\n            ChatMessagePF2e.create({\r\n                flavor: `<strong>${game.i18n.localize('PF2E.vehicle.collisionDamageLabel')}</strong>`,\r\n                speaker: ChatMessagePF2e.getSpeaker({ actor }),\r\n                type: CONST.CHAT_MESSAGE_TYPES.ROLL,\r\n                sound: 'sounds/dice.wav',\r\n                rolls: [roll],\r\n            })\r\n        })\r\n\r\n        html.find('input').on('change', async event => {\r\n            const target = event.currentTarget\r\n            const value = target.valueAsNumber\r\n            const attr = target.name\r\n\r\n            target.blur()\r\n\r\n            if (attr !== 'shield.value') await actor.update({ [attr]: value })\r\n            else await actor.heldShield.update({ 'system.hp.value': value })\r\n        })\r\n\r\n        html.find('[data-action=toggle-hero]').on('click contextmenu', event => {\r\n            event.preventDefault()\r\n            let { max, value } = actor.heroPoints\r\n\r\n            const change = event.type === 'click' ? 1 : -1\r\n            const newValue = Math.clamped(value + change, 0, max)\r\n\r\n            if (newValue !== value) actor.update({ 'system.resources.heroPoints.value': newValue })\r\n        })\r\n\r\n        html.find('[data-action=raise-shield]').on('click', event => {\r\n            event.preventDefault()\r\n            game.pf2e.actions.raiseAShield({ actors: [actor], tokens: [token] })\r\n        })\r\n\r\n        html.find('[data-action=take-cover]').on('click', async event => {\r\n            event.preventDefault()\r\n\r\n            const existing = getCoverEffect(actor)\r\n\r\n            if (existing) existing.delete()\r\n            else game.pf2e.actions.get('take-cover').use({ actors: [actor], tokens: [token] })\r\n        })\r\n\r\n        html.find('[data-action=roll-save]').on('click', event => {\r\n            event.preventDefault()\r\n            const save = event.currentTarget.dataset.save\r\n            actor.saves[save].roll({ event })\r\n        })\r\n\r\n        html.find('[data-action=roll-other]').on('click', event => {\r\n            event.preventDefault()\r\n            const slug = event.currentTarget.dataset.slug\r\n            if (slug !== 'athletics') {\r\n                const { ctrlKey, metaKey, shiftKey } = event\r\n                event = new MouseEvent('click', { ctrlKey: !ctrlKey, metaKey, shiftKey })\r\n            }\r\n            actor.getStatistic(slug)?.roll({ event })\r\n        })\r\n\r\n        html.find('[data-action=recovery-check]').on('click', event => {\r\n            event.preventDefault()\r\n            actor.rollRecovery(event)\r\n        })\r\n\r\n        html.find('[data-action=toggle-dying], [data-action=toggle-wounded]').on('click contextmenu', event => {\r\n            event.preventDefault()\r\n\r\n            const condition = event.currentTarget.dataset.action === 'toggle-dying' ? 'dying' : 'wounded'\r\n            const max = actor.system.attributes[condition]?.max\r\n\r\n            if (!max) return\r\n            if (event.type === 'click') actor.increaseCondition(condition, { max })\r\n            else actor.decreaseCondition(condition)\r\n        })\r\n\r\n        html.find('[data-action=use-resolve]').on('click', event => {\r\n            event.preventDefault()\r\n            useResolve(actor)\r\n        })\r\n\r\n        infos.filter('.speeds').on('click', event => {\r\n            this.#createHUDLockedListTooltip({\r\n                event,\r\n                content: event.currentTarget.dataset.tooltipContent,\r\n                direction: 'UP',\r\n                onClick: index => {\r\n                    setFlag(actor, `speeds.selected.${game.user.id}`, Number(index))\r\n                },\r\n            })\r\n        })\r\n    }\r\n\r\n    #createHUDLockedListTooltip({ content, event, onClick, selected, direction, locked }) {\r\n        createTooltip({\r\n            content,\r\n            target: event.currentTarget,\r\n            direction,\r\n            selected,\r\n            locked: true,\r\n            onCreate: () => this.lock(),\r\n            onClick,\r\n            onDismiss: () => this.unlock(),\r\n        })\r\n    }\r\n\r\n    async showFilter() {\r\n        let sidebar = this.sidebar\r\n        if (!sidebar.length) return\r\n        if (!sidebar.find('.sidebar-header').hasClass('show')) sidebar = await this.#openSidebar(sidebar.data().type, '')\r\n        sidebar.find('.sidebar-header').find('input').focus().select()\r\n        sidebar.scrollTop(0)\r\n    }\r\n\r\n    async #openSidebar(type, filter) {\r\n        type = typeof type === 'string' ? type : type.currentTarget.dataset.type\r\n\r\n        let element = this.element\r\n        let sidebar = this.sidebar\r\n        const action = sidebar[0]?.dataset.type\r\n\r\n        sidebar.remove()\r\n        element.find('[data-action=open-sidebar]').removeClass('active')\r\n\r\n        if (action === type && filter === undefined) {\r\n            this.unlock()\r\n            return\r\n        }\r\n\r\n        const token = this.#token\r\n        const actor = token.actor\r\n        const showFilter = filter !== undefined || getSetting('filter')\r\n        const { getData, addListeners } = SIDEBARS[type]\r\n        const data = (await getData({ hud: this, actor, token, filter: filter?.toLowerCase() })) ?? {}\r\n        if (!data.contentData && !showFilter) return ui.notifications.warn(localize(`${type}.empty`, { name: this.#token.name }))\r\n\r\n        const contentData = {\r\n            ...(data.contentData ?? {}),\r\n            isGM: game.user.isGM,\r\n            isCharacter: actor.isOfType('character'),\r\n            isOwner: actor.isOwner,\r\n            isCreature: actor.isOfType('creature'),\r\n        }\r\n\r\n        this.lock()\r\n\r\n        element.find(`[data-action=open-sidebar][data-type=${type}]`).addClass('active')\r\n        element = element[0]\r\n\r\n        const classes = data.classes ?? []\r\n        classes.push(type)\r\n        if (!getSetting('scrollbar')) classes.push('no-scrollbar')\r\n        if (data.doubled) classes.push('doubled')\r\n\r\n        const style = data.style ?? {}\r\n        style['--max-height'] = getSetting('height').trim() || '100%'\r\n\r\n        const tmp = document.createElement('div')\r\n        tmp.innerHTML = await renderTemplate(templatePath('sidebar'), {\r\n            classes: classes.join(' '),\r\n            style: Object.entries(style)\r\n                .map(([key, value]) => `${key}: ${value}`)\r\n                .join('; '),\r\n            type,\r\n            filter,\r\n            filterLabel: localize('filter'),\r\n            showFilter,\r\n            content: (await renderTemplate(templatePath(`sidebars/${type}`), contentData)).trim(),\r\n        })\r\n\r\n        sidebar = tmp.firstElementChild\r\n        element.append(sidebar)\r\n\r\n        const rect = sidebar.getBoundingClientRect()\r\n        const target = element.getBoundingClientRect()\r\n\r\n        let left\r\n        const position = getSetting('position')\r\n        if (position === 'left') {\r\n            left = target.x - rect.width\r\n            if (left < 0) left = target.right\r\n        } else {\r\n            left = target.right\r\n            if (left + rect.width > window.innerWidth) left = target.x - rect.width\r\n        }\r\n\r\n        const elPadding = parseInt(window.getComputedStyle(element).padding)\r\n        let top = postionFromTargetY(rect, target, elPadding)\r\n\r\n        sidebar.style.left = `${left}px`\r\n        sidebar.style.top = `${top}px`\r\n\r\n        sidebar = $(sidebar)\r\n        sidebar.find('.sidebar-header [data-action=sidebar-filter-clear]').on('click', event => {\r\n            event.preventDefault()\r\n            sidebar.find('.sidebar-header [data-action=sidebar-filter]').val('')\r\n            this.#openSidebar(type, '')\r\n        })\r\n        sidebar.find('.sidebar-header [data-action=sidebar-filter]').on('keydown', event => {\r\n            if (event.key === 'Enter') this.#openSidebar(type, event.currentTarget.value.trim())\r\n        })\r\n        addListeners({ el: sidebar, actor, token, hud: this })\r\n\r\n        Hooks.callAll('renderHUDSidebar', type, sidebar, this)\r\n\r\n        return sidebar\r\n    }\r\n}\r\n\r\nfunction postionFromTargetY(el, target, margin = 0) {\r\n    let y = target.y + target.height / 2 - el.height / 2\r\n    if (y + el.height > window.innerHeight) y = window.innerHeight - el.height - margin\r\n    if (y < 0) y = margin\r\n    return y\r\n}\r\n\r\nfunction postionFromTargetX(el, target) {\r\n    let x = target.x + target.width / 2 - el.width / 2\r\n    if (x + el.width > window.innerWidth) y = window.innerWidth - el.width\r\n    if (x < 0) x = 0\r\n    return x\r\n}\r\n\r\nfunction getAlliance(actor) {\r\n    const allianceSource = actor._source.system.details?.alliance\r\n    const alliance = allianceSource === null ? 'neutral' : allianceSource ?? 'default'\r\n    const defaultAlliance = actor.hasPlayerOwner ? 'party' : 'opposition'\r\n    return {\r\n        defaultAlliance,\r\n        originalAlliance: alliance,\r\n        alliance: alliance === 'default' ? defaultAlliance : alliance,\r\n    }\r\n}\r\n", "import { HUD } from './hud.js'\r\n\r\nexport const MODULE_ID = 'pf2e-token-hud'\r\n\r\nlet hud = null\r\nexport function getHud(element = false) {\r\n    return element ? hud?.element : hud\r\n}\r\n\r\nexport function enableModule(enabled) {\r\n    if (enabled && !hud) {\r\n        hud = new HUD()\r\n    } else if (!enabled && hud) {\r\n        hud.delete()\r\n        hud = null\r\n    }\r\n}\r\n\r\nexport function getSetting(setting) {\r\n    return game.settings.get(MODULE_ID, setting)\r\n}\r\n\r\nexport function localize(...args) {\r\n    const data = args.at(-1)\r\n    const useFormat = typeof data === 'object'\r\n\r\n    const keys = useFormat ? args.slice(0, -1) : args\r\n    keys.unshift(MODULE_ID)\r\n\r\n    return game.i18n[useFormat ? 'format' : 'localize'](keys.join('.'), data)\r\n}\r\n\r\nexport function hasFeat(actor, uuid) {\r\n    return actor.itemTypes.feat.some(feat => feat.sourceId === uuid)\r\n}\r\n\r\nexport function templatePath(template) {\r\n    return `modules/${MODULE_ID}/templates/${template}.hbs`\r\n}\r\n\r\nexport function modifier(mod) {\r\n    return mod >= 0 ? `+${mod}` : mod\r\n}\r\n\r\nexport function getFlag(doc, flag) {\r\n    return doc.getFlag(MODULE_ID, flag)\r\n}\r\n\r\nexport function setFlag(doc, flag, value) {\r\n    return doc.setFlag(MODULE_ID, flag, value)\r\n}\r\n\r\nexport async function enrichHTML(str, actor, { isOwner = actor.isOwner, rollData = actor.getRollData() } = {}) {\r\n    str = str?.trim()\r\n    if (!str) return ''\r\n    const enriched = await TextEditor.enrichHTML(str, { async: true, secrets: isOwner, rollData })\r\n    return enriched\r\n}\r\n\r\nexport function isInstanceOf(obj, name) {\r\n    if (typeof obj !== 'object') return false\r\n\r\n    while ((obj = Reflect.getPrototypeOf(obj))) {\r\n        if (obj.constructor.name === name) return true\r\n    }\r\n\r\n    return false\r\n}\r\n", "import { getHud, getSetting, MODULE_ID } from './module.js'\r\n\r\nexport function registerKeybindings() {\r\n    register('hold', {\r\n        onDown: () => {\r\n            if (getSetting('use-holding') !== 'none') getHud()?.setHolding(true)\r\n        },\r\n        onUp: () => {\r\n            getHud()?.setHolding(false)\r\n        },\r\n    })\r\n\r\n    register('filter', {\r\n        onUp: () => {\r\n            getHud()?.showFilter()\r\n        },\r\n        editable: [\r\n            {\r\n                key: 'KeyQ',\r\n                modifiers: ['Control'],\r\n            },\r\n        ],\r\n    })\r\n}\r\n\r\nfunction path(bind, key) {\r\n    return `${MODULE_ID}.keybinds.${bind}.${key}`\r\n}\r\n\r\nfunction register(name, extras = {}) {\r\n    game.keybindings.register(MODULE_ID, name, {\r\n        name: path(name, 'name'),\r\n        hint: path(name, 'hint'),\r\n        precedence: CONST.KEYBINDING_PRECEDENCE.PRIORITY,\r\n        ...extras,\r\n    })\r\n}\r\n", "import { enableModule, localize, MODULE_ID } from './module.js'\r\n\r\nexport function registerSettings() {\r\n    const isGM = game.data.users.find(x => x._id === game.data.userId).role >= CONST.USER_ROLES.GAMEMASTER\r\n\r\n    /**\r\n     * GM\r\n     */\r\n    const statuses = ['first', 'second', 'third', 'fourth'].map(x => localize(`settings.status.statuses.${x}`)).join(', ')\r\n    register('status', String, statuses, { scope: 'world' })\r\n\r\n    register('last-status', Boolean, false, { scope: 'world' })\r\n\r\n    register('party', Boolean, false, { scope: 'world' })\r\n\r\n    register('rk-dice', Boolean, false, { scope: 'world' })\r\n\r\n    /**\r\n     * CLIENT\r\n     */\r\n    register('enabled', Boolean, true, { onChange: enableModule })\r\n\r\n    register('position', String, 'right', {\r\n        choices: {\r\n            left: path('position', 'choices.left'),\r\n            right: path('position', 'choices.right'),\r\n            top: path('position', 'choices.top'),\r\n            bottom: path('position', 'choices.bottom'),\r\n        },\r\n    })\r\n\r\n    register('small-position', String, 'top', {\r\n        choices: {\r\n            left: path('position', 'choices.left'),\r\n            right: path('position', 'choices.right'),\r\n            top: path('position', 'choices.top'),\r\n            bottom: path('position', 'choices.bottom'),\r\n        },\r\n    })\r\n\r\n    register('delay', Number, 250, {\r\n        range: {\r\n            min: 0,\r\n            max: 2000,\r\n            step: 50,\r\n        },\r\n    })\r\n\r\n    register('scale', Number, 14, {\r\n        range: {\r\n            min: 10,\r\n            max: 30,\r\n            step: 1,\r\n        },\r\n    })\r\n\r\n    register('use-holding', String, 'none', {\r\n        hint: path('use-holding', isGM ? 'choices.gm.hint' : 'choices.player.hint'),\r\n        choices: {\r\n            none: path('use-holding', 'choices.none'),\r\n            half: path('use-holding', isGM ? 'choices.gm.half' : 'choices.player.half'),\r\n            all: path('use-holding', isGM ? 'choices.gm.all' : 'choices.player.all'),\r\n        },\r\n    })\r\n\r\n    register('autolock', String, 'none', {\r\n        choices: {\r\n            none: path('autolock', 'choices.none'),\r\n            hover: path('autolock', 'choices.hover'),\r\n            render: path('autolock', 'choices.render'),\r\n        },\r\n    })\r\n\r\n    register('chat-close', Boolean, false)\r\n    register('attack-close', Boolean, false)\r\n    register('action-close', Boolean, false)\r\n    register('cast-close', Boolean, false)\r\n    register('skill-close', Boolean, false)\r\n    register('macro-close', Boolean, false)\r\n    register('use-close', Boolean, false)\r\n\r\n    register('no-dead', Boolean, false)\r\n\r\n    register('observer', Boolean, true)\r\n\r\n    register('see-status', Boolean, false)\r\n\r\n    // tooltip\r\n\r\n    register('saves', String, 'bonus', {\r\n        choices: {\r\n            none: path('saves', 'choices.none'),\r\n            bonus: path('saves', 'choices.bonus'),\r\n            dc: path('saves', 'choices.dc'),\r\n        },\r\n    })\r\n\r\n    register('others', String, 'none', {\r\n        choices: {\r\n            none: path('saves', 'choices.none'),\r\n            bonus: path('saves', 'choices.bonus'),\r\n            dc: path('saves', 'choices.dc'),\r\n        },\r\n    })\r\n\r\n    register('ranks', Boolean, false)\r\n\r\n    register('show-death', String, 'always', {\r\n        choices: {\r\n            none: path('show-death', 'choices.none'),\r\n            always: path('show-death', 'choices.always'),\r\n            only: path('show-death', 'choices.only'),\r\n        },\r\n    })\r\n\r\n    register('force-speed', Boolean, false)\r\n\r\n    register('tooltips', Boolean, false)\r\n\r\n    register('pips', Boolean, false)\r\n\r\n    // distance\r\n\r\n    register('distance', String, 'all', {\r\n        choices: {\r\n            none: path('distance', 'choices.none'),\r\n            self: path('distance', 'choices.self'),\r\n            all: path('distance', 'choices.all'),\r\n        },\r\n    })\r\n\r\n    register('unit', String, '')\r\n\r\n    // sidebar\r\n\r\n    register('height', String, '')\r\n\r\n    register('filter', Boolean, false)\r\n\r\n    register('scrollbar', Boolean, true)\r\n\r\n    register('hazard-width', Number, 32, {\r\n        range: {\r\n            min: 14,\r\n            max: 50,\r\n            step: 1,\r\n        },\r\n    })\r\n\r\n    register('actions-columns', Boolean, false)\r\n\r\n    register('items-columns', Boolean, false)\r\n\r\n    register('spells-columns', Boolean, false)\r\n\r\n    register('skills-columns', Boolean, false)\r\n\r\n    // actions\r\n\r\n    register('actions', String, 'split', {\r\n        choices: {\r\n            name: path('actions', 'choices.name'),\r\n            type: path('actions', 'choices.type'),\r\n            split: path('actions', 'choices.split'),\r\n        },\r\n    })\r\n\r\n    register('actions-colors', Boolean, true)\r\n\r\n    register('action-effect', Boolean, false)\r\n\r\n    // items\r\n\r\n    register('containers', Boolean, false)\r\n\r\n    // spells\r\n\r\n    register('spells-sort', String, 'disabled', {\r\n        choices: {\r\n            disabled: path('spells-sort', 'choices.disabled'),\r\n            type: path('spells-sort', 'choices.type'),\r\n            entry: path('spells-sort', 'choices.entry'),\r\n        },\r\n    })\r\n\r\n    register('tradition', Boolean, false)\r\n\r\n    // skills\r\n\r\n    register('untrained', Boolean, true)\r\n}\r\n\r\nexport function renderSettingsConfig(_, html) {\r\n    const tab = html.find(`.tab[data-tab=${MODULE_ID}]`)\r\n\r\n    function beforeGroup(name, key, dom = 'h3') {\r\n        const localized = localize(`menu.${key}`)\r\n        tab.find(`[name=\"${MODULE_ID}.${name}\"]`).closest('.form-group').before(`<${dom}>${localized}</${dom}>`)\r\n    }\r\n\r\n    if (game.user.isGM) {\r\n        beforeGroup('enabled', 'client.header', 'h2')\r\n    }\r\n\r\n    beforeGroup('saves', 'client.tooltip')\r\n    beforeGroup('distance', 'client.distance')\r\n    beforeGroup('height', 'client.sidebar')\r\n    beforeGroup('actions', 'client.actions')\r\n    beforeGroup('containers', 'client.items')\r\n    beforeGroup('spells', 'client.spells')\r\n    beforeGroup('untrained', 'client.skills')\r\n    // beforeGroup('', 'client.extras')\r\n}\r\n\r\nfunction path(setting, key) {\r\n    return `${MODULE_ID}.settings.${setting}.${key}`\r\n}\r\n\r\nfunction register(name, type, defValue, extra = {}) {\r\n    game.settings.register(MODULE_ID, name, {\r\n        name: path(name, 'name'),\r\n        hint: path(name, 'hint'),\r\n        scope: 'client',\r\n        config: true,\r\n        type,\r\n        default: defValue,\r\n        ...extra,\r\n    })\r\n}\r\n", "import { registerKeybindings } from './keybindings.js'\r\nimport { enableModule, getSetting, localize, MODULE_ID, templatePath, getHud } from './module.js'\r\nimport { registerSettings, renderSettingsConfig } from './settings.js'\r\nimport { deleteMacro, getMacros, onDroppedMacro } from './shared.js'\r\n\r\nHooks.once('setup', async () => {\r\n    registerSettings()\r\n    registerKeybindings()\r\n\r\n    await loadTemplates({\r\n        creature: templatePath('tooltips/creature'),\r\n        hazard: templatePath('tooltips/hazard'),\r\n        vehicle: templatePath('tooltips/vehicle'),\r\n    })\r\n})\r\n\r\nHooks.once('ready', () => {\r\n    if (getSetting('enabled')) enableModule(true)\r\n\r\n    game.modules.get('pf2e-token-hud').api = {\r\n        getHud,\r\n    }\r\n})\r\n\r\nHooks.on('renderSettingsConfig', renderSettingsConfig)\r\n\r\nHooks.on('drawMeasuredTemplate', template => {\r\n    if (template.isPreview) getHud()?.close()\r\n})\r\n\r\nHooks.on('getActorDirectoryEntryContext', (_, data) => {\r\n    data.unshift({\r\n        icon: '<i class=\"fa-solid fa-code\"></i>',\r\n        name: `${MODULE_ID}.actor.macros.contextmenu`,\r\n        condition: html => {\r\n            const { documentId } = html.data()\r\n            return getSetting('enabled') && game.actors.get(documentId)?.isOwner\r\n        },\r\n        callback: html => {\r\n            const { documentId } = html.data()\r\n            openMacrosDialog(documentId)\r\n        },\r\n    })\r\n})\r\n\r\nclass DataDialog extends Dialog {\r\n    async getData(options = {}) {\r\n        const data = super.getData(options)\r\n        if (typeof data.content === 'function') data.content = await data.content()\r\n        return data\r\n    }\r\n}\r\n\r\nfunction openMacrosDialog(actorId) {\r\n    const actor = game.actors.get(actorId)\r\n    if (!actor) return\r\n\r\n    const dialog = new DataDialog(\r\n        {\r\n            title: `${actor.name} - ${localize('actor.macros.title')}`,\r\n            content: async () => {\r\n                const macros = getMacros(actor) ?? []\r\n                return renderTemplate(templatePath('dialogs/macros'), {\r\n                    macros,\r\n                    noMacro: localize('extras.no-macro'),\r\n                })\r\n            },\r\n            buttons: {},\r\n            render: html => {\r\n                actor.apps[dialog.appId] = dialog\r\n                html.on('drop', event => onDroppedMacro(event, actor))\r\n                html.find('[data-action=delete-macro]').on('click', event => deleteMacro(event, actor))\r\n            },\r\n            close: () => {\r\n                delete actor.apps[dialog.appId]\r\n            },\r\n        },\r\n        { height: 'auto' }\r\n    ).render(true)\r\n}\r\n"],
  "mappings": "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",
  "names": ["RESOLVE_UUID", "useResolve", "actor", "toChat", "content", "__name", "name", "attributes", "system", "sp", "resolve", "fullStamina", "localize", "noResolve", "hasSteel", "item", "templatePath", "str", "html", "selected", "ratio", "newSP", "getDamageRollClass", "Roll", "__name", "getChatMessageClass", "__name", "dcAdjustments", "dcByLevel", "adjustDC", "dc", "adjustment", "__name", "rarityToDCAdjustment", "rarity", "adjustDCByRarity", "calculateDC", "level", "proficiencyWithoutLevel", "htmlQueryAll", "parent", "selectors", "__name", "htmlClosest", "child", "actionImgMap", "actionGlyphMap", "getActionIcon", "action", "fallback", "value", "sanitized", "__name", "getActionGlyph", "ErrorPF2e", "message", "tupleHasValue", "array", "value", "__name", "objectHasKey", "obj", "key", "wordCharacter", "nonWordCharacter", "nonWordCharacterRE", "wordBoundary", "nonWordBoundary", "lowerCaseLetter", "upperCaseLetter", "lowerCaseThenUpperCaseRE", "nonWordCharacterHyphenOrSpaceRE", "upperOrWordBoundariedLowerRE", "sluggify", "text", "camel", "dromedary", "part", "index", "ErrorPF2e", "setHasElement", "set", "value", "__name", "traitSlugToObject", "trait", "dictionary", "traitObject", "objectHasKey", "ordinalString", "pluralRules", "suffix", "isRelevantEvent", "event", "__name", "eventToRollParams", "rollType", "key", "skipDefault", "params", "SAVE_TYPES", "inlineSelector", "keyword", "injectRepostElement", "links", "foundryDoc", "link", "repostButtons", "htmlQueryAll", "button", "newButton", "icon", "event", "target", "parent", "document", "resolveDocument", "repostAction", "__name", "flavorDamageRolls", "html", "actor", "rollLink", "itemId", "htmlClosest", "item", "makeRepostHtml", "defaultVisibility", "flavor", "d", "resolveActor", "content", "ChatMessagePF2e", "getChatMessageClass", "speaker", "message", "flags", "listenInlineRoll", "l", "pf2Action", "pf2Glyph", "pf2Variant", "pf2Dc", "pf2ShowDc", "pf2Skill", "action", "sluggify", "visibility", "pf2Check", "pf2Traits", "pf2Label", "pf2Defense", "pf2Adjustment", "pf2Roller", "pf2RollOptions", "actors", "extraRollOptions", "o", "eventRollParams", "eventToRollParams", "flatCheck", "dc", "isSavingThrow", "tupleHasValue", "traits", "t", "statistic", "bestSpellcasting", "c", "s", "a", "b", "ErrorPF2e", "targetActor", "dcValue", "adjustment", "calculateDC", "defenseStat", "itemFromDoc", "args", "subtitleLocKey", "getActionGlyph", "templateConversion", "pf2EffectArea", "pf2Distance", "pf2TemplateData", "pf2Width", "templateData", "distance", "objectHasKey", "messageId", "isInstanceOf", "origin", "anchor", "itemUuid", "itemByUUID", "RANKS", "COVER_UUID", "getItemSummary", "el", "actor", "dataset", "item", "data", "description", "listenInlineRoll", "__name", "addNameTooltipListeners", "targetEl", "event", "target", "width", "name", "editItem", "getItemFromEvent", "deleteItem", "localize", "itemId", "getMacros", "getFlag", "uuid", "macro", "onDroppedMacro", "type", "flag", "macros", "setFlag", "deleteMacro", "index", "getUniqueTarget", "condition", "targets", "filterIn", "value", "filter", "localeCompare", "a", "b", "getCoverEffect", "effect", "popup", "title", "content", "actor", "hud", "getHud", "el", "tmp", "localize", "enrichHTML", "__name", "showItemSummary", "description", "getItemSummary", "unownedItemToMessage", "event", "item", "actor", "rollMode", "create", "data", "ChatMessagePF2e", "getChatMessageClass", "template", "sluggify", "token", "nearestItem", "contextualData", "templateData", "chatData", "u", "__name", "createSelfEffectMessage", "ErrorPF2e", "actionCost", "speaker", "flavor", "getActionGlyph", "t", "traitSlugToObject", "previewLength", "descriptionPreview", "tempDiv", "documentTypes", "linkPattern", "_match", "args", "description", "content", "flags", "toggleWeaponTrait", "weapon", "trait", "selection", "item", "r", "__name", "DEGREE_OF_SUCCESS", "DEGREE_ADJUSTMENT_AMOUNTS", "adjustDegreeOfSuccess", "amount", "degreeOfSuccess", "__name", "adjustDegreeByDieValue", "dieResult", "degree", "calculateDegreeOfSuccess", "rollTotal", "dc", "SKILLS", "SUCCESS", "rollRecallKnowledges", "actor", "roll", "dieResult", "dieSuccess", "lores", "skill", "target", "getUniqueTarget", "data", "str", "localize", "standard", "skills", "lore", "skillsDCs", "loresDCs", "progression", "dcs", "slug", "rollSkill", "rkDice", "getSetting", "options", "templatePath", "__name", "rank", "label", "mod", "total", "modifier", "RANKS", "dc", "success", "calculateDegreeOfSuccess", "MODULE_ID", "UNTRAINED_IMPROVISATION", "CROWBAR_UUIDS", "BON_MOT_UUID", "NATURAL_MEDICINE_UUID", "FOLLOW_THE_EXPERT_UUID", "LABELS", "ACTIONS_UUIDS", "DUPLICATE_SKILLS", "SKILLS", "actor", "item", "hasFeat", "skill", "action", "slug", "actions", "unslugged", "_", "variant", "modifiers", "modifier", "SKILLS_SLUGS", "SKILLS_MAP", "skills", "skillActionsUUIDS", "getSkillLabel", "__name", "getSkillsData", "filter", "isCharacter", "noUntrained", "getSetting", "feat", "i", "label", "rank", "mod", "name", "actionsList", "condition", "trained", "passedFilter", "filterIn", "filteredActions", "variants", "a", "b", "localeCompare", "lores", "lore", "loresModifierWidth", "width", "localize", "isFollowingAnExpert", "addSkillsListeners", "el", "token", "hud", "event", "showItemSummary", "following", "source", "target", "skillSlug", "map", "variantsDialog", "rollAction", "uuid", "unownedItemToMessage", "effect", "base", "dc", "content", "templatePath", "str", "html", "type", "rollOptions", "options", "extrasUUIDS", "getExtrasData", "actor", "filter", "attributes", "initiative", "localize", "getMacros", "macro", "filterIn", "SKILLS_SLUGS", "slug", "getSkillLabel", "__name", "addExtrasListeners", "el", "token", "hud", "action", "callback", "type", "event", "showItemSummary", "addNameTooltipListeners", "getMacro", "uuid", "deleteMacro", "getSetting", "onDroppedMacro", "item", "unownedItemToMessage", "target", "value", "dailies", "rollRecallKnowledges", "variants", "variantsDialog", "note", "multipleAttackPenalty", "SECTIONS_TYPES", "getActionsData", "hud", "actor", "filter", "isCharacter", "toggles", "sorting", "getSetting", "stances", "getStancesModuleApi", "a", "b", "localeCompare", "heroActions", "getHeroActionsApi", "heroDiff", "isOwner", "rollData", "strikes", "strike", "index", "enrichHTML", "altUsage", "blast", "blasts", "config", "damageType", "damage", "formulaFor", "__name", "outcome", "melee", "sections", "actions", "getCharacterActions", "getNpcActions", "action", "filterIn", "type", "getActionIcon", "orderA", "orderB", "nb", "canTradeHeroActions", "str", "localize", "label", "addActionsListeners", "el", "addNameTooltipListeners", "callback", "x", "event", "getStrike", "strikeEl", "s", "getUuid", "showItemSummary", "uuid", "description", "name", "popup", "templatePath", "trait", "stance", "item", "getItemFromEvent", "createSelfEffectMessage", "applyActionEffect", "effectUuid", "actionId", "exploration", "id", "api", "toggle", "domain", "option", "itemId", "suboption", "modular", "weapon", "target", "value", "baseType", "selection", "toggleWeaponTrait", "ammo", "selectors", "_", "blastEl", "element", "dataset", "mapIncreases", "getToolBeltModule", "setting", "module", "getToolBeltApi", "stancesUUIDS", "actionUUID", "actionsUUIDS", "skillActionsUUIDS", "extrasUUIDS", "feats", "inParty", "explorations", "sourceId", "actionCost", "traits", "isExploration", "actionType", "hasAura", "source", "getHazardData", "actor", "system", "details", "traits", "attributes", "stealth", "description", "disable", "routine", "reset", "isComplex", "rollData", "isOwner", "enrich", "__name", "str", "enrichHTML", "trait", "modifier", "getSetting", "addHazardListeners", "el", "event", "action", "showItemSummary", "listenInlineRoll", "MAGIC_TRADITIONS", "getDcRarity", "item", "__name", "getMagicTraditions", "traits", "t", "setHasElement", "getIdentifyMagicDCs", "baseDC", "notMatchingTraditionModifier", "result", "traditions", "key", "getItemIdentificationDCs", "proficiencyWithoutLevel", "calculateDC", "rarity", "dc", "adjustDCByRarity", "objectHasKey", "obj", "IdentifyItemPopup", "dcs", "$form", "event", "$button", "itemImg", "itemName", "identifiedName", "skills", "row", "slug", "name", "actionOption", "content", "getChatMessageClass", "_event", "formData", "status", "createTooltip", "target", "selected", "direction", "onCreate", "onDismiss", "onClick", "content", "cssClass", "locked", "resolve", "tooltipClass", "MODULE_ID", "exist", "el", "dismissTooltip", "value", "label", "tooltip", "getSetting", "c", "event", "__name", "ITEMS_TYPES", "getItemsData", "actor", "filter", "contents", "coins", "totalWealth", "bulk", "invested", "isCreature", "openedContainers", "getSetting", "getFlag", "containers", "categories", "item", "type", "containerId", "items", "a", "b", "localeCompare", "i", "container", "contained", "filterIn", "category", "str", "localize", "__name", "addItemsListeners", "el", "token", "hud", "addNameTooltipListeners", "event", "showItemSummary", "flag", "index", "setFlag", "getItemFromEvent", "target", "itemType", "uuid", "img", "itemId", "IdentifyItemPopup", "editItem", "deleteItem", "tmp", "content", "menu", "current", "inSlot", "handsHeld", "carryType", "dismissTooltip", "rows", "createTooltip", "getSpellsData", "actor", "filter", "focusPool", "entries", "showTradition", "getSetting", "pf2eStavesActive", "pf2eDailies", "pf2eDailiesActive", "stavesActive", "chargesPath", "spells", "focuses", "hasFocusCantrips", "entry", "entryId", "tradition", "data", "isFocus", "isCharge", "charges", "dailiesData", "max", "canPayCost", "slot", "slotSpells", "isCantrip", "slotId", "active", "spell", "expended", "virtual", "uses", "castLevel", "filterIn", "MODULE_ID", "sortingSetting", "sort", "a", "localeCompare", "compareEntries", "b", "rituals", "attacks", "getSpellAttacks", "nb", "hasSingleSpellAttack", "rank", "ordinalString", "__name", "statistic", "name", "id", "modifier", "mod", "addSpellsListeners", "el", "hud", "addNameTooltipListeners", "event", "showItemSummary", "localize", "html", "templatePath", "rollParams", "eventToRollParams", "map", "item", "getItemFromEvent", "change", "points", "slotLevel", "itemId", "collection", "inputPath", "value", "HOVER_EXCEPTIONS", "POSITIONS", "ALLIANCES", "SPEEDS", "SIDEBARS", "getActionsData", "addActionsListeners", "getItemsData", "addItemsListeners", "getSpellsData", "addSpellsListeners", "getSkillsData", "addSkillsListeners", "getExtrasData", "addExtrasListeners", "getHazardData", "addHazardListeners", "SAVES", "SKILLS", "HUD", "#token", "#lastToken", "#hoveredToken", "#delay", "#holding", "#closing", "#mousedown", "#lock", "#softLock", "#isObserved", "#hoverTokenHandler", "#mouseeventHandler", "#deleteTokenHandler", "token", "hover", "#tokenEnter", "#tokenLeave", "event", "button", "target", "el", "popup", "#cancelDelay", "isObserved", "actor", "#checkIfObserved", "held", "holding", "getSetting", "isParty", "#cancelClosing", "delay", "close", "templatePath", "getCoverEffect", "distance", "savesSetting", "othersSetting", "isCharacter", "attributes", "hp", "ac", "sp", "useStamina", "showDistance", "fontSize", "unitSplit", "multiplier", "unit", "decimals", "selected", "isTarget", "getUniqueTarget", "status", "statuses", "x", "max", "current", "ratio", "pick", "length", "sharedData", "level", "saves", "isOwner", "system", "itemTypes", "resistances", "weaknesses", "immunities", "action", "showRanks", "getStatistic", "stat", "type", "stats", "slug", "value", "modifier", "RANKS", "__name", "toIWR", "category", "header", "rows", "toInfo", "hardness", "emitsSound", "stealth", "enrichHTML", "save", "MODULE_ID", "collisionDC", "collisionDamage", "details", "crew", "passengers", "pilotingCheck", "speed", "showDeath", "heroPoints", "traits", "resources", "wounded", "dying", "shield", "adjustment", "str", "sort", "a", "b", "localeCompare", "languages", "senses", "speeds", "icon", "index", "s", "selectedSpeed", "getFlag", "mainSpeed", "base", "prev", "otherSpeeds", "label", "getAlliance", "options", "states", "cls", "force", "sidebarType", "sidebarScrolltop", "popupScrollTop", "filter", "sidebar", "filterHeader", "#openSidebar", "html", "element", "scale", "hud", "targetCoords", "coords", "positions", "position", "postionFromTargetY", "postionFromTargetX", "ChatMessagePF2e", "getChatMessageClass", "publicNotes", "privateNotes", "blurb", "trait", "content", "infos", "#createHUDLockedListTooltip", "createTooltip", "originalAlliance", "defaultAlliance", "dc", "formula", "DamageRoll", "getDamageRollClass", "roll", "attr", "change", "newValue", "existing", "ctrlKey", "metaKey", "shiftKey", "condition", "useResolve", "setFlag", "onClick", "direction", "locked", "showFilter", "getData", "addListeners", "data", "localize", "contentData", "classes", "style", "tmp", "key", "rect", "left", "elPadding", "top", "margin", "y", "allianceSource", "alliance", "MODULE_ID", "hud", "getHud", "element", "__name", "enableModule", "enabled", "HUD", "getSetting", "setting", "localize", "args", "data", "useFormat", "keys", "hasFeat", "actor", "uuid", "feat", "templatePath", "template", "modifier", "mod", "getFlag", "doc", "flag", "setFlag", "value", "enrichHTML", "str", "isOwner", "rollData", "isInstanceOf", "obj", "name", "registerKeybindings", "register", "getSetting", "getHud", "__name", "path", "bind", "key", "MODULE_ID", "name", "extras", "registerSettings", "isGM", "x", "statuses", "localize", "register", "enableModule", "path", "__name", "renderSettingsConfig", "_", "html", "tab", "MODULE_ID", "beforeGroup", "name", "key", "dom", "localized", "setting", "type", "defValue", "extra", "registerSettings", "registerKeybindings", "templatePath", "getSetting", "enableModule", "getHud", "renderSettingsConfig", "template", "_", "data", "MODULE_ID", "html", "documentId", "openMacrosDialog", "DataDialog", "options", "__name", "actorId", "actor", "dialog", "localize", "macros", "getMacros", "event", "onDroppedMacro", "deleteMacro"]
}
